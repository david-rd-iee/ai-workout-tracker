import{a as ia}from"./chunk-2BSN6BV4.js";import{$a as Yt,Aa as Ae,Ab as Ct,Ba as ko,Bb as Zo,Ca as Oo,Da as Do,Db as ea,Ea as et,Eb as ta,Fa as tt,Ga as xn,Ha as W,Ia as Mo,Ib as na,Ja as Fo,Ka as ae,L as ks,La as nt,M as po,Ma as Ms,Mb as sa,N as mo,Na as Gt,O as _o,Oa as Un,P as go,Pa as Lo,Qa as xo,R as yo,Ra as Uo,S as vo,Sa as Bo,T as Eo,Ta as $o,U as wo,Ua as Ht,V as To,Va as Fs,Wa as ye,X as So,Xa as ee,Ya as qo,Za as wt,_a as Vo,a as N,ab as Ls,b as On,bb as Wo,c as Ie,cb as te,d as Dn,db as he,eb as Tt,f as Ue,fb as St,gb as jo,hb as Pe,i as Be,ia as bo,ib as zo,j as ro,jb as M,k as q,ka as _,kb as Ko,l as Mn,la as gt,lb as Go,m as Ps,ma as Co,mb as Ho,na as Io,nb as $e,oa as Ao,ob as qe,p as oo,pa as Fn,pb as Ve,q as ge,qa as Ro,qb as We,r as ao,ra as yt,rb as je,s as lo,sa as Os,sb as ze,t as co,ta as Ze,tb as Ke,ua as vt,ub as Yo,va as Ln,vb as Qo,w as uo,wa as Et,wb as Xo,x as ho,xa as Ds,xb as bt,y as fo,ya as No,yb as Jo,za as Po}from"./chunk-GYEOV455.js";import"./chunk-JILRXST5.js";import"./chunk-PE2S3EMJ.js";import"./chunk-3WPYDWGG.js";import"./chunk-LEOUPRPX.js";import"./chunk-3UNZRHNY.js";import"./chunk-III6E2XH.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-3QXY74KK.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{a as Kt,d as io,g as y}from"./chunk-PM2M367S.js";var T=(function(n){return n[n.State=0]="State",n[n.Transition=1]="Transition",n[n.Sequence=2]="Sequence",n[n.Group=3]="Group",n[n.Animate=4]="Animate",n[n.Keyframes=5]="Keyframes",n[n.Style=6]="Style",n[n.Trigger=7]="Trigger",n[n.Reference=8]="Reference",n[n.AnimateChild=9]="AnimateChild",n[n.AnimateRef=10]="AnimateRef",n[n.Query=11]="Query",n[n.Stagger=12]="Stagger",n})(T||{}),ve="*";function ra(n,e=null){return{type:T.Sequence,steps:n,options:e}}function xs(n){return{type:T.Style,styles:n,offset:null}}var ke=class{_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_originalOnDoneFns=[];_originalOnStartFns=[];_started=!1;_destroyed=!1;_finished=!1;_position=0;parentPlayer=null;totalTime;constructor(e=0,t=0){this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(s=>s()),t.length=0}},It=class{_onDoneFns=[];_onStartFns=[];_finished=!1;_started=!1;_destroyed=!1;_onDestroyFns=[];parentPlayer=null;totalTime=0;players;constructor(e){this.players=e;let t=0,s=0,i=0,r=this.players.length;r==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(o=>{o.onDone(()=>{++t==r&&this._onFinish()}),o.onDestroy(()=>{++s==r&&this._onDestroy()}),o.onStart(()=>{++i==r&&this._onStart()})}),this.totalTime=this.players.reduce((o,a)=>Math.max(o,a.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){let t=e*this.totalTime;this.players.forEach(s=>{let i=s.totalTime?Math.min(1,t/s.totalTime):1;s.setPosition(i)})}getPosition(){let e=this.players.reduce((t,s)=>t===null||s.totalTime>t.totalTime?s:t,null);return e!=null?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){let t=e=="start"?this._onStartFns:this._onDoneFns;t.forEach(s=>s()),t.length=0}},Qt="!";function oa(n){return new N(3e3,!1)}function lh(){return new N(3100,!1)}function ch(){return new N(3101,!1)}function uh(n){return new N(3001,!1)}function hh(n){return new N(3003,!1)}function dh(n){return new N(3004,!1)}function la(n,e){return new N(3005,!1)}function ca(){return new N(3006,!1)}function ua(){return new N(3007,!1)}function ha(n,e){return new N(3008,!1)}function da(n){return new N(3002,!1)}function fa(n,e,t,s,i){return new N(3010,!1)}function pa(){return new N(3011,!1)}function ma(){return new N(3012,!1)}function _a(){return new N(3200,!1)}function ga(){return new N(3202,!1)}function ya(){return new N(3013,!1)}function va(n){return new N(3014,!1)}function Ea(n){return new N(3015,!1)}function wa(n){return new N(3016,!1)}function Ta(n,e){return new N(3404,!1)}function fh(n){return new N(3502,!1)}function Sa(n){return new N(3503,!1)}function ba(){return new N(3300,!1)}function Ca(n){return new N(3504,!1)}function Ia(n){return new N(3301,!1)}function Aa(n,e){return new N(3302,!1)}function Ra(n){return new N(3303,!1)}function Na(n,e){return new N(3400,!1)}function Pa(n){return new N(3401,!1)}function ka(n){return new N(3402,!1)}function Oa(n,e){return new N(3505,!1)}function Oe(n){switch(n.length){case 0:return new ke;case 1:return n[0];default:return new It(n)}}function qs(n,e,t=new Map,s=new Map){let i=[],r=[],o=-1,a=null;if(e.forEach(l=>{let c=l.get("offset"),h=c==o,u=h&&a||new Map;l.forEach((d,p)=>{let f=p,m=d;if(p!=="offset")switch(f=n.normalizePropertyName(f,i),m){case Qt:m=t.get(p);break;case ve:m=s.get(p);break;default:m=n.normalizeStyleValue(p,f,m,i);break}u.set(f,m)}),h||r.push(u),a=u,o=c}),i.length)throw fh(i);return r}function Bn(n,e,t,s){switch(e){case"start":n.onStart(()=>s(t&&Us(t,"start",n)));break;case"done":n.onDone(()=>s(t&&Us(t,"done",n)));break;case"destroy":n.onDestroy(()=>s(t&&Us(t,"destroy",n)));break}}function Us(n,e,t){let s=t.totalTime,i=!!t.disabled,r=$n(n.element,n.triggerName,n.fromState,n.toState,e||n.phaseName,s??n.totalTime,i),o=n._data;return o!=null&&(r._data=o),r}function $n(n,e,t,s,i="",r=0,o){return{element:n,triggerName:e,fromState:t,toState:s,phaseName:i,totalTime:r,disabled:!!o}}function ne(n,e,t){let s=n.get(e);return s||n.set(e,s=t),s}function Vs(n){let e=n.indexOf(":"),t=n.substring(1,e),s=n.slice(e+1);return[t,s]}var ph=typeof document>"u"?null:document.documentElement;function qn(n){let e=n.parentNode||n.host||null;return e===ph?null:e}function mh(n){return n.substring(1,6)=="ebkit"}var st=null,aa=!1;function Da(n){st||(st=_h()||{},aa=st.style?"WebkitAppearance"in st.style:!1);let e=!0;return st.style&&!mh(n)&&(e=n in st.style,!e&&aa&&(e="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in st.style)),e}function _h(){return typeof document<"u"?document.body:null}function Ws(n,e){for(;e;){if(e===n)return!0;e=qn(e)}return!1}function js(n,e,t){if(t)return Array.from(n.querySelectorAll(e));let s=n.querySelector(e);return s?[s]:[]}var gh=1e3,zs="{{",yh="}}",Ks="ng-enter",Vn="ng-leave",Xt="ng-trigger",Jt=".ng-trigger",Gs="ng-animating",Wn=".ng-animating";function Re(n){if(typeof n=="number")return n;let e=n.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:Bs(parseFloat(e[1]),e[2])}function Bs(n,e){switch(e){case"s":return n*gh;default:return n}}function Zt(n,e,t){return n.hasOwnProperty("duration")?n:Eh(n,e,t)}var vh=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i;function Eh(n,e,t){let s,i=0,r="";if(typeof n=="string"){let o=n.match(vh);if(o===null)return e.push(oa(n)),{duration:0,delay:0,easing:""};s=Bs(parseFloat(o[1]),o[2]);let a=o[3];a!=null&&(i=Bs(parseFloat(a),o[4]));let l=o[5];l&&(r=l)}else s=n;if(!t){let o=!1,a=e.length;s<0&&(e.push(lh()),o=!0),i<0&&(e.push(ch()),o=!0),o&&e.splice(a,0,oa(n))}return{duration:s,delay:i,easing:r}}function Ma(n){return n.length?n[0]instanceof Map?n:n.map(e=>new Map(Object.entries(e))):[]}function Ee(n,e,t){e.forEach((s,i)=>{let r=jn(i);t&&!t.has(i)&&t.set(i,n.style[r]),n.style[r]=s})}function Ge(n,e){e.forEach((t,s)=>{let i=jn(s);n.style[i]=""})}function At(n){return Array.isArray(n)?n.length==1?n[0]:ra(n):n}function Fa(n,e,t){let s=e.params||{},i=Hs(n);i.length&&i.forEach(r=>{s.hasOwnProperty(r)||t.push(uh(r))})}var $s=new RegExp(`${zs}\\s*(.+?)\\s*${yh}`,"g");function Hs(n){let e=[];if(typeof n=="string"){let t;for(;t=$s.exec(n);)e.push(t[1]);$s.lastIndex=0}return e}function Rt(n,e,t){let s=`${n}`,i=s.replace($s,(r,o)=>{let a=e[o];return a==null&&(t.push(hh(o)),a=""),a.toString()});return i==s?n:i}var wh=/-+([a-z0-9])/g;function jn(n){return n.replace(wh,(...e)=>e[1].toUpperCase())}function La(n,e){return n===0||e===0}function xa(n,e,t){if(t.size&&e.length){let s=e[0],i=[];if(t.forEach((r,o)=>{s.has(o)||i.push(o),s.set(o,r)}),i.length)for(let r=1;r<e.length;r++){let o=e[r];i.forEach(a=>o.set(a,zn(n,a)))}}return e}function se(n,e,t){switch(e.type){case T.Trigger:return n.visitTrigger(e,t);case T.State:return n.visitState(e,t);case T.Transition:return n.visitTransition(e,t);case T.Sequence:return n.visitSequence(e,t);case T.Group:return n.visitGroup(e,t);case T.Animate:return n.visitAnimate(e,t);case T.Keyframes:return n.visitKeyframes(e,t);case T.Style:return n.visitStyle(e,t);case T.Reference:return n.visitReference(e,t);case T.AnimateChild:return n.visitAnimateChild(e,t);case T.AnimateRef:return n.visitAnimateRef(e,t);case T.Query:return n.visitQuery(e,t);case T.Stagger:return n.visitStagger(e,t);default:throw dh(e.type)}}function zn(n,e){return window.getComputedStyle(n)[e]}var hi=(()=>{class n{validateStyleProperty(t){return Da(t)}containsElement(t,s){return Ws(t,s)}getParentElement(t){return qn(t)}query(t,s,i){return js(t,s,i)}computeStyle(t,s,i){return i||""}animate(t,s,i,r,o,a=[],l){return new ke(i,r)}static \u0275fac=function(s){return new(s||n)};static \u0275prov=On({token:n,factory:n.\u0275fac})}return n})(),rt=class{static NOOP=new hi},ot=class{};var Th=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),Qn=class extends ot{normalizePropertyName(e,t){return jn(e)}normalizeStyleValue(e,t,s,i){let r="",o=s.toString().trim();if(Th.has(t)&&s!==0&&s!=="0")if(typeof s=="number")r="px";else{let a=s.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&a[1].length==0&&i.push(la(e,s))}return o+r}};var Xn="*";function Sh(n,e){let t=[];return typeof n=="string"?n.split(/\s*,\s*/).forEach(s=>bh(s,t,e)):t.push(n),t}function bh(n,e,t){if(n[0]==":"){let l=Ch(n,t);if(typeof l=="function"){e.push(l);return}n=l}let s=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(s==null||s.length<4)return t.push(Ea(n)),e;let i=s[1],r=s[2],o=s[3];e.push(Ua(i,o));let a=i==Xn&&o==Xn;r[0]=="<"&&!a&&e.push(Ua(o,i))}function Ch(n,e){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,s)=>parseFloat(s)>parseFloat(t);case":decrement":return(t,s)=>parseFloat(s)<parseFloat(t);default:return e.push(wa(n)),"* => *"}}var Kn=new Set(["true","1"]),Gn=new Set(["false","0"]);function Ua(n,e){let t=Kn.has(n)||Gn.has(n),s=Kn.has(e)||Gn.has(e);return(i,r)=>{let o=n==Xn||n==i,a=e==Xn||e==r;return!o&&t&&typeof i=="boolean"&&(o=i?Kn.has(n):Gn.has(n)),!a&&s&&typeof r=="boolean"&&(a=r?Kn.has(e):Gn.has(e)),o&&a}}var Ya=":self",Ih=new RegExp(`s*${Ya}s*,?`,"g");function Qa(n,e,t,s){return new ei(n).build(e,t,s)}var Ba="",ei=class{_driver;constructor(e){this._driver=e}build(e,t,s){let i=new ti(t);return this._resetContextStyleTimingState(i),se(this,At(e),i)}_resetContextStyleTimingState(e){e.currentQuerySelector=Ba,e.collectedStyles=new Map,e.collectedStyles.set(Ba,new Map),e.currentTime=0}visitTrigger(e,t){let s=t.queryCount=0,i=t.depCount=0,r=[],o=[];return e.name.charAt(0)=="@"&&t.errors.push(ca()),e.definitions.forEach(a=>{if(this._resetContextStyleTimingState(t),a.type==T.State){let l=a,c=l.name;c.toString().split(/\s*,\s*/).forEach(h=>{l.name=h,r.push(this.visitState(l,t))}),l.name=c}else if(a.type==T.Transition){let l=this.visitTransition(a,t);s+=l.queryCount,i+=l.depCount,o.push(l)}else t.errors.push(ua())}),{type:T.Trigger,name:e.name,states:r,transitions:o,queryCount:s,depCount:i,options:null}}visitState(e,t){let s=this.visitStyle(e.styles,t),i=e.options&&e.options.params||null;if(s.containsDynamicStyles){let r=new Set,o=i||{};s.styles.forEach(a=>{a instanceof Map&&a.forEach(l=>{Hs(l).forEach(c=>{o.hasOwnProperty(c)||r.add(c)})})}),r.size&&t.errors.push(ha(e.name,[...r.values()]))}return{type:T.State,name:e.name,style:s,options:i?{params:i}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;let s=se(this,At(e.animation),t),i=Sh(e.expr,t.errors);return{type:T.Transition,matchers:i,animation:s,queryCount:t.queryCount,depCount:t.depCount,options:it(e.options)}}visitSequence(e,t){return{type:T.Sequence,steps:e.steps.map(s=>se(this,s,t)),options:it(e.options)}}visitGroup(e,t){let s=t.currentTime,i=0,r=e.steps.map(o=>{t.currentTime=s;let a=se(this,o,t);return i=Math.max(i,t.currentTime),a});return t.currentTime=i,{type:T.Group,steps:r,options:it(e.options)}}visitAnimate(e,t){let s=Ph(e.timings,t.errors);t.currentAnimateTimings=s;let i,r=e.styles?e.styles:xs({});if(r.type==T.Keyframes)i=this.visitKeyframes(r,t);else{let o=e.styles,a=!1;if(!o){a=!0;let c={};s.easing&&(c.easing=s.easing),o=xs(c)}t.currentTime+=s.duration+s.delay;let l=this.visitStyle(o,t);l.isEmptyStep=a,i=l}return t.currentAnimateTimings=null,{type:T.Animate,timings:s,style:i,options:null}}visitStyle(e,t){let s=this._makeStyleAst(e,t);return this._validateStyleAst(s,t),s}_makeStyleAst(e,t){let s=[],i=Array.isArray(e.styles)?e.styles:[e.styles];for(let a of i)typeof a=="string"?a===ve?s.push(a):t.errors.push(da(a)):s.push(new Map(Object.entries(a)));let r=!1,o=null;return s.forEach(a=>{if(a instanceof Map&&(a.has("easing")&&(o=a.get("easing"),a.delete("easing")),!r)){for(let l of a.values())if(l.toString().indexOf(zs)>=0){r=!0;break}}}),{type:T.Style,styles:s,easing:o,offset:e.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(e,t){let s=t.currentAnimateTimings,i=t.currentTime,r=t.currentTime;s&&r>0&&(r-=s.duration+s.delay),e.styles.forEach(o=>{typeof o!="string"&&o.forEach((a,l)=>{let c=t.collectedStyles.get(t.currentQuerySelector),h=c.get(l),u=!0;h&&(r!=i&&r>=h.startTime&&i<=h.endTime&&(t.errors.push(fa(l,h.startTime,h.endTime,r,i)),u=!1),r=h.startTime),u&&c.set(l,{startTime:r,endTime:i}),t.options&&Fa(a,t.options,t.errors)})})}visitKeyframes(e,t){let s={type:T.Keyframes,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(pa()),s;let i=1,r=0,o=[],a=!1,l=!1,c=0,h=e.steps.map(P=>{let D=this._makeStyleAst(P,t),k=D.offset!=null?D.offset:Nh(D.styles),C=0;return k!=null&&(r++,C=D.offset=k),l=l||C<0||C>1,a=a||C<c,c=C,o.push(C),D});l&&t.errors.push(ma()),a&&t.errors.push(_a());let u=e.steps.length,d=0;r>0&&r<u?t.errors.push(ga()):r==0&&(d=i/(u-1));let p=u-1,f=t.currentTime,m=t.currentAnimateTimings,v=m.duration;return h.forEach((P,D)=>{let k=d>0?D==p?1:d*D:o[D],C=k*v;t.currentTime=f+m.delay+C,m.duration=C,this._validateStyleAst(P,t),P.offset=k,s.styles.push(P)}),s}visitReference(e,t){return{type:T.Reference,animation:se(this,At(e.animation),t),options:it(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:T.AnimateChild,options:it(e.options)}}visitAnimateRef(e,t){return{type:T.AnimateRef,animation:this.visitReference(e.animation,t),options:it(e.options)}}visitQuery(e,t){let s=t.currentQuerySelector,i=e.options||{};t.queryCount++,t.currentQuery=e;let[r,o]=Ah(e.selector);t.currentQuerySelector=s.length?s+" "+r:r,ne(t.collectedStyles,t.currentQuerySelector,new Map);let a=se(this,At(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=s,{type:T.Query,selector:r,limit:i.limit||0,optional:!!i.optional,includeSelf:o,animation:a,originalSelector:e.selector,options:it(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(ya());let s=e.timings==="full"?{duration:0,delay:0,easing:"full"}:Zt(e.timings,t.errors,!0);return{type:T.Stagger,animation:se(this,At(e.animation),t),timings:s,options:null}}};function Ah(n){let e=!!n.split(/\s*,\s*/).find(t=>t==Ya);return e&&(n=n.replace(Ih,"")),n=n.replace(/@\*/g,Jt).replace(/@\w+/g,t=>Jt+"-"+t.slice(1)).replace(/:animating/g,Wn),[n,e]}function Rh(n){return n?Kt({},n):null}var ti=class{errors;queryCount=0;depCount=0;currentTransition=null;currentQuery=null;currentQuerySelector=null;currentAnimateTimings=null;currentTime=0;collectedStyles=new Map;options=null;unsupportedCSSPropertiesFound=new Set;constructor(e){this.errors=e}};function Nh(n){if(typeof n=="string")return null;let e=null;if(Array.isArray(n))n.forEach(t=>{if(t instanceof Map&&t.has("offset")){let s=t;e=parseFloat(s.get("offset")),s.delete("offset")}});else if(n instanceof Map&&n.has("offset")){let t=n;e=parseFloat(t.get("offset")),t.delete("offset")}return e}function Ph(n,e){if(n.hasOwnProperty("duration"))return n;if(typeof n=="number"){let r=Zt(n,e).duration;return Ys(r,0,"")}let t=n;if(t.split(/\s+/).some(r=>r.charAt(0)=="{"&&r.charAt(1)=="{")){let r=Ys(0,0,"");return r.dynamic=!0,r.strValue=t,r}let i=Zt(t,e);return Ys(i.duration,i.delay,i.easing)}function it(n){return n?(n=Kt({},n),n.params&&(n.params=Rh(n.params))):n={},n}function Ys(n,e,t){return{duration:n,delay:e,easing:t}}function di(n,e,t,s,i,r,o=null,a=!1){return{type:1,element:n,keyframes:e,preStyleProps:t,postStyleProps:s,duration:i,delay:r,totalTime:i+r,easing:o,subTimeline:a}}var tn=class{_map=new Map;get(e){return this._map.get(e)||[]}append(e,t){let s=this._map.get(e);s||this._map.set(e,s=[]),s.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}},kh=1,Oh=":enter",Dh=new RegExp(Oh,"g"),Mh=":leave",Fh=new RegExp(Mh,"g");function Xa(n,e,t,s,i,r=new Map,o=new Map,a,l,c=[]){return new ni().buildKeyframes(n,e,t,s,i,r,o,a,l,c)}var ni=class{buildKeyframes(e,t,s,i,r,o,a,l,c,h=[]){c=c||new tn;let u=new si(e,t,c,i,r,h,[]);u.options=l;let d=l.delay?Re(l.delay):0;u.currentTimeline.delayNextStep(d),u.currentTimeline.setStyles([o],null,u.errors,l),se(this,s,u);let p=u.timelines.filter(f=>f.containsAnimation());if(p.length&&a.size){let f;for(let m=p.length-1;m>=0;m--){let v=p[m];if(v.element===t){f=v;break}}f&&!f.allowOnlyTimelineStyles()&&f.setStyles([a],null,u.errors,l)}return p.length?p.map(f=>f.buildKeyframes()):[di(t,[],[],[],0,d,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){let s=t.subInstructions.get(t.element);if(s){let i=t.createSubContext(e.options),r=t.currentTimeline.currentTime,o=this._visitSubInstructions(s,i,i.options);r!=o&&t.transformIntoNewTimeline(o)}t.previousNode=e}visitAnimateRef(e,t){let s=t.createSubContext(e.options);s.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,s),this.visitReference(e.animation,s),t.transformIntoNewTimeline(s.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,s){for(let i of e){let r=i?.delay;if(r){let o=typeof r=="number"?r:Re(Rt(r,i?.params??{},t.errors));s.delayNextStep(o)}}}_visitSubInstructions(e,t,s){let r=t.currentTimeline.currentTime,o=s.duration!=null?Re(s.duration):null,a=s.delay!=null?Re(s.delay):null;return o!==0&&e.forEach(l=>{let c=t.appendInstructionToTimeline(l,o,a);r=Math.max(r,c.duration+c.delay)}),r}visitReference(e,t){t.updateOptions(e.options,!0),se(this,e.animation,t),t.previousNode=e}visitSequence(e,t){let s=t.subContextCount,i=t,r=e.options;if(r&&(r.params||r.delay)&&(i=t.createSubContext(r),i.transformIntoNewTimeline(),r.delay!=null)){i.previousNode.type==T.Style&&(i.currentTimeline.snapshotCurrentStyles(),i.previousNode=Jn);let o=Re(r.delay);i.delayNextStep(o)}e.steps.length&&(e.steps.forEach(o=>se(this,o,i)),i.currentTimeline.applyStylesToKeyframe(),i.subContextCount>s&&i.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){let s=[],i=t.currentTimeline.currentTime,r=e.options&&e.options.delay?Re(e.options.delay):0;e.steps.forEach(o=>{let a=t.createSubContext(e.options);r&&a.delayNextStep(r),se(this,o,a),i=Math.max(i,a.currentTimeline.currentTime),s.push(a.currentTimeline)}),s.forEach(o=>t.currentTimeline.mergeTimelineCollectedStyles(o)),t.transformIntoNewTimeline(i),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){let s=e.strValue,i=t.params?Rt(s,t.params,t.errors):s;return Zt(i,t.errors)}else return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){let s=t.currentAnimateTimings=this._visitTiming(e.timings,t),i=t.currentTimeline;s.delay&&(t.incrementTime(s.delay),i.snapshotCurrentStyles());let r=e.style;r.type==T.Keyframes?this.visitKeyframes(r,t):(t.incrementTime(s.duration),this.visitStyle(r,t),i.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){let s=t.currentTimeline,i=t.currentAnimateTimings;!i&&s.hasCurrentStyleProperties()&&s.forwardFrame();let r=i&&i.easing||e.easing;e.isEmptyStep?s.applyEmptyStep(r):s.setStyles(e.styles,r,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){let s=t.currentAnimateTimings,i=t.currentTimeline.duration,r=s.duration,a=t.createSubContext().currentTimeline;a.easing=s.easing,e.styles.forEach(l=>{let c=l.offset||0;a.forwardTime(c*r),a.setStyles(l.styles,l.easing,t.errors,t.options),a.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(a),t.transformIntoNewTimeline(i+r),t.previousNode=e}visitQuery(e,t){let s=t.currentTimeline.currentTime,i=e.options||{},r=i.delay?Re(i.delay):0;r&&(t.previousNode.type===T.Style||s==0&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=Jn);let o=s,a=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!i.optional,t.errors);t.currentQueryTotal=a.length;let l=null;a.forEach((c,h)=>{t.currentQueryIndex=h;let u=t.createSubContext(e.options,c);r&&u.delayNextStep(r),c===t.element&&(l=u.currentTimeline),se(this,e.animation,u),u.currentTimeline.applyStylesToKeyframe();let d=u.currentTimeline.currentTime;o=Math.max(o,d)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),l&&(t.currentTimeline.mergeTimelineCollectedStyles(l),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){let s=t.parentContext,i=t.currentTimeline,r=e.timings,o=Math.abs(r.duration),a=o*(t.currentQueryTotal-1),l=o*t.currentQueryIndex;switch(r.duration<0?"reverse":r.easing){case"reverse":l=a-l;break;case"full":l=s.currentStaggerTime;break}let h=t.currentTimeline;l&&h.delayNextStep(l);let u=h.currentTime;se(this,e.animation,t),t.previousNode=e,s.currentStaggerTime=i.currentTime-u+(i.startTime-s.currentTimeline.startTime)}},Jn={},si=class n{_driver;element;subInstructions;_enterClassName;_leaveClassName;errors;timelines;parentContext=null;currentTimeline;currentAnimateTimings=null;previousNode=Jn;subContextCount=0;options={};currentQueryIndex=0;currentQueryTotal=0;currentStaggerTime=0;constructor(e,t,s,i,r,o,a,l){this._driver=e,this.element=t,this.subInstructions=s,this._enterClassName=i,this._leaveClassName=r,this.errors=o,this.timelines=a,this.currentTimeline=l||new Zn(this._driver,t,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;let s=e,i=this.options;s.duration!=null&&(i.duration=Re(s.duration)),s.delay!=null&&(i.delay=Re(s.delay));let r=s.params;if(r){let o=i.params;o||(o=this.options.params={}),Object.keys(r).forEach(a=>{(!t||!o.hasOwnProperty(a))&&(o[a]=Rt(r[a],o,this.errors))})}}_copyOptions(){let e={};if(this.options){let t=this.options.params;if(t){let s=e.params={};Object.keys(t).forEach(i=>{s[i]=t[i]})}}return e}createSubContext(e=null,t,s){let i=t||this.element,r=new n(this._driver,i,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(i,s||0));return r.previousNode=this.previousNode,r.currentAnimateTimings=this.currentAnimateTimings,r.options=this._copyOptions(),r.updateOptions(e),r.currentQueryIndex=this.currentQueryIndex,r.currentQueryTotal=this.currentQueryTotal,r.parentContext=this,this.subContextCount++,r}transformIntoNewTimeline(e){return this.previousNode=Jn,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,s){let i={duration:t??e.duration,delay:this.currentTimeline.currentTime+(s??0)+e.delay,easing:""},r=new ii(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,i,e.stretchStartingKeyframe);return this.timelines.push(r),i}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,s,i,r,o){let a=[];if(i&&a.push(this.element),e.length>0){e=e.replace(Dh,"."+this._enterClassName),e=e.replace(Fh,"."+this._leaveClassName);let l=s!=1,c=this._driver.query(this.element,e,l);s!==0&&(c=s<0?c.slice(c.length+s,c.length):c.slice(0,s)),a.push(...c)}return!r&&a.length==0&&o.push(va(t)),a}},Zn=class n{_driver;element;startTime;_elementTimelineStylesLookup;duration=0;easing=null;_previousKeyframe=new Map;_currentKeyframe=new Map;_keyframes=new Map;_styleSummary=new Map;_localTimelineStyles=new Map;_globalTimelineStyles;_pendingStyles=new Map;_backFill=new Map;_currentEmptyStepKeyframe=null;constructor(e,t,s,i){this._driver=e,this.element=t,this.startTime=s,this._elementTimelineStylesLookup=i,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){let t=this._keyframes.size===1&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new n(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=kh,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,s]of this._globalTimelineStyles)this._backFill.set(t,s||ve),this._currentKeyframe.set(t,ve);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,s,i){t&&this._previousKeyframe.set("easing",t);let r=i&&i.params||{},o=Lh(e,this._globalTimelineStyles);for(let[a,l]of o){let c=Rt(l,r,s);this._pendingStyles.set(a,c),this._localTimelineStyles.has(a)||this._backFill.set(a,this._globalTimelineStyles.get(a)??ve),this._updateStyle(a,c)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,s)=>{let i=this._styleSummary.get(s);(!i||t.time>i.time)&&this._updateStyle(s,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();let e=new Set,t=new Set,s=this._keyframes.size===1&&this.duration===0,i=[];this._keyframes.forEach((a,l)=>{let c=new Map([...this._backFill,...a]);c.forEach((h,u)=>{h===Qt?e.add(u):h===ve&&t.add(u)}),s||c.set("offset",l/this.duration),i.push(c)});let r=[...e.values()],o=[...t.values()];if(s){let a=i[0],l=new Map(a);a.set("offset",0),l.set("offset",1),i=[a,l]}return di(this.element,i,r,o,this.duration,this.startTime,this.easing,!1)}},ii=class extends Zn{keyframes;preStyleProps;postStyleProps;_stretchStartingKeyframe;timings;constructor(e,t,s,i,r,o,a=!1){super(e,t,o.delay),this.keyframes=s,this.preStyleProps=i,this.postStyleProps=r,this._stretchStartingKeyframe=a,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:s,easing:i}=this.timings;if(this._stretchStartingKeyframe&&t){let r=[],o=s+t,a=t/o,l=new Map(e[0]);l.set("offset",0),r.push(l);let c=new Map(e[0]);c.set("offset",$a(a)),r.push(c);let h=e.length-1;for(let u=1;u<=h;u++){let d=new Map(e[u]),p=d.get("offset"),f=t+p*s;d.set("offset",$a(f/o)),r.push(d)}s=o,t=0,i="",e=r}return di(this.element,e,this.preStyleProps,this.postStyleProps,s,t,i,!0)}};function $a(n,e=3){let t=Math.pow(10,e-1);return Math.round(n*t)/t}function Lh(n,e){let t=new Map,s;return n.forEach(i=>{if(i==="*"){s??=e.keys();for(let r of s)t.set(r,ve)}else for(let[r,o]of i)t.set(r,o)}),t}function qa(n,e,t,s,i,r,o,a,l,c,h,u,d){return{type:0,element:n,triggerName:e,isRemovalTransition:i,fromState:t,fromStyles:r,toState:s,toStyles:o,timelines:a,queriedElements:l,preStyleProps:c,postStyleProps:h,totalTime:u,errors:d}}var Qs={},es=class{_triggerName;ast;_stateStyles;constructor(e,t,s){this._triggerName=e,this.ast=t,this._stateStyles=s}match(e,t,s,i){return xh(this.ast.matchers,e,t,s,i)}buildStyles(e,t,s){let i=this._stateStyles.get("*");return e!==void 0&&(i=this._stateStyles.get(e?.toString())||i),i?i.buildStyles(t,s):new Map}build(e,t,s,i,r,o,a,l,c,h){let u=[],d=this.ast.options&&this.ast.options.params||Qs,p=a&&a.params||Qs,f=this.buildStyles(s,p,u),m=l&&l.params||Qs,v=this.buildStyles(i,m,u),P=new Set,D=new Map,k=new Map,C=i==="void",Z={params:Ja(m,d),delay:this.ast.options?.delay},K=h?[]:Xa(e,t,this.ast.animation,r,o,f,v,Z,c,u),$=0;return K.forEach(S=>{$=Math.max(S.duration+S.delay,$)}),u.length?qa(t,this._triggerName,s,i,C,f,v,[],[],D,k,$,u):(K.forEach(S=>{let B=S.element,z=ne(D,B,new Set);S.preStyleProps.forEach(G=>z.add(G));let _e=ne(k,B,new Set);S.postStyleProps.forEach(G=>_e.add(G)),B!==t&&P.add(B)}),qa(t,this._triggerName,s,i,C,f,v,K,[...P.values()],D,k,$))}};function xh(n,e,t,s,i){return n.some(r=>r(e,t,s,i))}function Ja(n,e){let t=Kt({},e);return Object.entries(n).forEach(([s,i])=>{i!=null&&(t[s]=i)}),t}var ri=class{styles;defaultParams;normalizer;constructor(e,t,s){this.styles=e,this.defaultParams=t,this.normalizer=s}buildStyles(e,t){let s=new Map,i=Ja(e,this.defaultParams);return this.styles.styles.forEach(r=>{typeof r!="string"&&r.forEach((o,a)=>{o&&(o=Rt(o,i,t));let l=this.normalizer.normalizePropertyName(a,t);o=this.normalizer.normalizeStyleValue(a,l,o,t),s.set(a,o)})}),s}};function Uh(n,e,t){return new oi(n,e,t)}var oi=class{name;ast;_normalizer;transitionFactories=[];fallbackTransition;states=new Map;constructor(e,t,s){this.name=e,this.ast=t,this._normalizer=s,t.states.forEach(i=>{let r=i.options&&i.options.params||{};this.states.set(i.name,new ri(i.style,r,s))}),Va(this.states,"true","1"),Va(this.states,"false","0"),t.transitions.forEach(i=>{this.transitionFactories.push(new es(e,i,this.states))}),this.fallbackTransition=Bh(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,s,i){return this.transitionFactories.find(o=>o.match(e,t,s,i))||null}matchStyles(e,t,s){return this.fallbackTransition.buildStyles(e,t,s)}};function Bh(n,e,t){let s=[(o,a)=>!0],i={type:T.Sequence,steps:[],options:null},r={type:T.Transition,animation:i,matchers:s,options:null,queryCount:0,depCount:0};return new es(n,r,e)}function Va(n,e,t){n.has(e)?n.has(t)||n.set(t,n.get(e)):n.has(t)&&n.set(e,n.get(t))}var $h=new tn,ai=class{bodyNode;_driver;_normalizer;_animations=new Map;_playersById=new Map;players=[];constructor(e,t,s){this.bodyNode=e,this._driver=t,this._normalizer=s}register(e,t){let s=[],i=[],r=Qa(this._driver,t,s,i);if(s.length)throw Sa(s);this._animations.set(e,r)}_buildPlayer(e,t,s){let i=e.element,r=qs(this._normalizer,e.keyframes,t,s);return this._driver.animate(i,r,e.duration,e.delay,e.easing,[],!0)}create(e,t,s={}){let i=[],r=this._animations.get(e),o,a=new Map;if(r?(o=Xa(this._driver,t,r,Ks,Vn,new Map,new Map,s,$h,i),o.forEach(h=>{let u=ne(a,h.element,new Map);h.postStyleProps.forEach(d=>u.set(d,null))})):(i.push(ba()),o=[]),i.length)throw Ca(i);a.forEach((h,u)=>{h.forEach((d,p)=>{h.set(p,this._driver.computeStyle(u,p,ve))})});let l=o.map(h=>{let u=a.get(h.element);return this._buildPlayer(h,new Map,u)}),c=Oe(l);return this._playersById.set(e,c),c.onDestroy(()=>this.destroy(e)),this.players.push(c),c}destroy(e){let t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);let s=this.players.indexOf(t);s>=0&&this.players.splice(s,1)}_getPlayer(e){let t=this._playersById.get(e);if(!t)throw Ia(e);return t}listen(e,t,s,i){let r=$n(t,"","","");return Bn(this._getPlayer(e),s,r,i),()=>{}}command(e,t,s,i){if(s=="register"){this.register(e,i[0]);return}if(s=="create"){let o=i[0]||{};this.create(e,t,o);return}let r=this._getPlayer(e);switch(s){case"play":r.play();break;case"pause":r.pause();break;case"reset":r.reset();break;case"restart":r.restart();break;case"finish":r.finish();break;case"init":r.init();break;case"setPosition":r.setPosition(parseFloat(i[0]));break;case"destroy":this.destroy(e);break}}},Wa="ng-animate-queued",qh=".ng-animate-queued",Xs="ng-animate-disabled",Vh=".ng-animate-disabled",Wh="ng-star-inserted",jh=".ng-star-inserted",zh=[],Za={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},Kh={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},we="__ng_removed",nn=class{namespaceId;value;options;get params(){return this.options.params}constructor(e,t=""){this.namespaceId=t;let s=e&&e.hasOwnProperty("value"),i=s?e.value:e;if(this.value=Hh(i),s){let r=e,{value:o}=r,a=io(r,["value"]);this.options=a}else this.options={};this.options.params||(this.options.params={})}absorbOptions(e){let t=e.params;if(t){let s=this.options.params;Object.keys(t).forEach(i=>{s[i]==null&&(s[i]=t[i])})}}},en="void",Js=new nn(en),li=class{id;hostElement;_engine;players=[];_triggers=new Map;_queue=[];_elementListeners=new Map;_hostClassName;constructor(e,t,s){this.id=e,this.hostElement=t,this._engine=s,this._hostClassName="ng-tns-"+e,de(t,this._hostClassName)}listen(e,t,s,i){if(!this._triggers.has(t))throw Aa(s,t);if(s==null||s.length==0)throw Ra(t);if(!Yh(s))throw Na(s,t);let r=ne(this._elementListeners,e,[]),o={name:t,phase:s,callback:i};r.push(o);let a=ne(this._engine.statesByElement,e,new Map);return a.has(t)||(de(e,Xt),de(e,Xt+"-"+t),a.set(t,Js)),()=>{this._engine.afterFlush(()=>{let l=r.indexOf(o);l>=0&&r.splice(l,1),this._triggers.has(t)||a.delete(t)})}}register(e,t){return this._triggers.has(e)?!1:(this._triggers.set(e,t),!0)}_getTrigger(e){let t=this._triggers.get(e);if(!t)throw Pa(e);return t}trigger(e,t,s,i=!0){let r=this._getTrigger(t),o=new sn(this.id,t,e),a=this._engine.statesByElement.get(e);a||(de(e,Xt),de(e,Xt+"-"+t),this._engine.statesByElement.set(e,a=new Map));let l=a.get(t),c=new nn(s,this.id);if(!(s&&s.hasOwnProperty("value"))&&l&&c.absorbOptions(l.options),a.set(t,c),l||(l=Js),!(c.value===en)&&l.value===c.value){if(!Jh(l.params,c.params)){let m=[],v=r.matchStyles(l.value,l.params,m),P=r.matchStyles(c.value,c.params,m);m.length?this._engine.reportError(m):this._engine.afterFlush(()=>{Ge(e,v),Ee(e,P)})}return}let d=ne(this._engine.playersByElement,e,[]);d.forEach(m=>{m.namespaceId==this.id&&m.triggerName==t&&m.queued&&m.destroy()});let p=r.matchTransition(l.value,c.value,e,c.params),f=!1;if(!p){if(!i)return;p=r.fallbackTransition,f=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:p,fromState:l,toState:c,player:o,isFallbackTransition:f}),f||(de(e,Wa),o.onStart(()=>{Nt(e,Wa)})),o.onDone(()=>{let m=this.players.indexOf(o);m>=0&&this.players.splice(m,1);let v=this._engine.playersByElement.get(e);if(v){let P=v.indexOf(o);P>=0&&v.splice(P,1)}}),this.players.push(o),d.push(o),o}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,s)=>{this._elementListeners.set(s,t.filter(i=>i.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);let t=this._engine.playersByElement.get(e);t&&(t.forEach(s=>s.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){let s=this._engine.driver.query(e,Jt,!0);s.forEach(i=>{if(i[we])return;let r=this._engine.fetchNamespacesByElement(i);r.size?r.forEach(o=>o.triggerLeaveAnimation(i,t,!1,!0)):this.clearElementCache(i)}),this._engine.afterFlushAnimationsDone(()=>s.forEach(i=>this.clearElementCache(i)))}triggerLeaveAnimation(e,t,s,i){let r=this._engine.statesByElement.get(e),o=new Map;if(r){let a=[];if(r.forEach((l,c)=>{if(o.set(c,l.value),this._triggers.has(c)){let h=this.trigger(e,c,en,i);h&&a.push(h)}}),a.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,o),s&&Oe(a).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){let t=this._elementListeners.get(e),s=this._engine.statesByElement.get(e);if(t&&s){let i=new Set;t.forEach(r=>{let o=r.name;if(i.has(o))return;i.add(o);let l=this._triggers.get(o).fallbackTransition,c=s.get(o)||Js,h=new nn(en),u=new sn(this.id,o,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:o,transition:l,fromState:c,toState:h,player:u,isFallbackTransition:!0})})}}removeNode(e,t){let s=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let i=!1;if(s.totalAnimations){let r=s.players.length?s.playersByQueriedElement.get(e):[];if(r&&r.length)i=!0;else{let o=e;for(;o=o.parentNode;)if(s.statesByElement.get(o)){i=!0;break}}}if(this.prepareLeaveAnimationListeners(e),i)s.markElementAsRemoved(this.id,e,!1,t);else{let r=e[we];(!r||r===Za)&&(s.afterFlush(()=>this.clearElementCache(e)),s.destroyInnerAnimations(e),s._onRemovalComplete(e,t))}}insertNode(e,t){de(e,this._hostClassName)}drainQueuedTransitions(e){let t=[];return this._queue.forEach(s=>{let i=s.player;if(i.destroyed)return;let r=s.element,o=this._elementListeners.get(r);o&&o.forEach(a=>{if(a.name==s.triggerName){let l=$n(r,s.triggerName,s.fromState.value,s.toState.value);l._data=e,Bn(s.player,a.phase,l,a.callback)}}),i.markedForDestroy?this._engine.afterFlush(()=>{i.destroy()}):t.push(s)}),this._queue=[],t.sort((s,i)=>{let r=s.transition.ast.depCount,o=i.transition.ast.depCount;return r==0||o==0?r-o:this._engine.driver.containsElement(s.element,i.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}},ci=class{bodyNode;driver;_normalizer;players=[];newHostElements=new Map;playersByElement=new Map;playersByQueriedElement=new Map;statesByElement=new Map;disabledNodes=new Set;totalAnimations=0;totalQueuedPlayers=0;_namespaceLookup={};_namespaceList=[];_flushFns=[];_whenQuietFns=[];namespacesByHostElement=new Map;collectedEnterElements=[];collectedLeaveElements=[];onRemovalComplete=(e,t)=>{};_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}constructor(e,t,s){this.bodyNode=e,this.driver=t,this._normalizer=s}get queuedPlayers(){let e=[];return this._namespaceList.forEach(t=>{t.players.forEach(s=>{s.queued&&e.push(s)})}),e}createNamespace(e,t){let s=new li(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(s,t):(this.newHostElements.set(t,s),this.collectEnterElement(t)),this._namespaceLookup[e]=s}_balanceNamespaceList(e,t){let s=this._namespaceList,i=this.namespacesByHostElement;if(s.length-1>=0){let o=!1,a=this.driver.getParentElement(t);for(;a;){let l=i.get(a);if(l){let c=s.indexOf(l);s.splice(c+1,0,e),o=!0;break}a=this.driver.getParentElement(a)}o||s.unshift(e)}else s.push(e);return i.set(t,e),e}register(e,t){let s=this._namespaceLookup[e];return s||(s=this.createNamespace(e,t)),s}registerTrigger(e,t,s){let i=this._namespaceLookup[e];i&&i.register(t,s)&&this.totalAnimations++}destroy(e,t){e&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let s=this._fetchNamespace(e);this.namespacesByHostElement.delete(s.hostElement);let i=this._namespaceList.indexOf(s);i>=0&&this._namespaceList.splice(i,1),s.destroy(t),delete this._namespaceLookup[e]}))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){let t=new Set,s=this.statesByElement.get(e);if(s){for(let i of s.values())if(i.namespaceId){let r=this._fetchNamespace(i.namespaceId);r&&t.add(r)}}return t}trigger(e,t,s,i){if(Hn(t)){let r=this._fetchNamespace(e);if(r)return r.trigger(t,s,i),!0}return!1}insertNode(e,t,s,i){if(!Hn(t))return;let r=t[we];if(r&&r.setForRemoval){r.setForRemoval=!1,r.setForMove=!0;let o=this.collectedLeaveElements.indexOf(t);o>=0&&this.collectedLeaveElements.splice(o,1)}if(e){let o=this._fetchNamespace(e);o&&o.insertNode(t,s)}i&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),de(e,Xs)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),Nt(e,Xs))}removeNode(e,t,s){if(Hn(t)){let i=e?this._fetchNamespace(e):null;i?i.removeNode(t,s):this.markElementAsRemoved(e,t,!1,s);let r=this.namespacesByHostElement.get(t);r&&r.id!==e&&r.removeNode(t,s)}else this._onRemovalComplete(t,s)}markElementAsRemoved(e,t,s,i,r){this.collectedLeaveElements.push(t),t[we]={namespaceId:e,setForRemoval:i,hasAnimation:s,removedBeforeQueried:!1,previousTriggersValues:r}}listen(e,t,s,i,r){return Hn(t)?this._fetchNamespace(e).listen(t,s,i,r):()=>{}}_buildInstruction(e,t,s,i,r){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,s,i,e.fromState.options,e.toState.options,t,r)}destroyInnerAnimations(e){let t=this.driver.query(e,Jt,!0);t.forEach(s=>this.destroyActiveAnimationsForElement(s)),this.playersByQueriedElement.size!=0&&(t=this.driver.query(e,Wn,!0),t.forEach(s=>this.finishActiveQueriedAnimationOnElement(s)))}destroyActiveAnimationsForElement(e){let t=this.playersByElement.get(e);t&&t.forEach(s=>{s.queued?s.markedForDestroy=!0:s.destroy()})}finishActiveQueriedAnimationOnElement(e){let t=this.playersByQueriedElement.get(e);t&&t.forEach(s=>s.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Oe(this.players).onDone(()=>e());e()})}processLeaveNode(e){let t=e[we];if(t&&t.setForRemoval){if(e[we]=Za,t.namespaceId){this.destroyInnerAnimations(e);let s=this._fetchNamespace(t.namespaceId);s&&s.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(Xs)&&this.markElementAsDisabled(e,!1),this.driver.query(e,Vh,!0).forEach(s=>{this.markElementAsDisabled(s,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((s,i)=>this._balanceNamespaceList(s,i)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let s=0;s<this.collectedEnterElements.length;s++){let i=this.collectedEnterElements[s];de(i,Wh)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let s=[];try{t=this._flushAnimations(s,e)}finally{for(let i=0;i<s.length;i++)s[i]()}}else for(let s=0;s<this.collectedLeaveElements.length;s++){let i=this.collectedLeaveElements[s];this.processLeaveNode(i)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(s=>s()),this._flushFns=[],this._whenQuietFns.length){let s=this._whenQuietFns;this._whenQuietFns=[],t.length?Oe(t).onDone(()=>{s.forEach(i=>i())}):s.forEach(i=>i())}}reportError(e){throw ka(e)}_flushAnimations(e,t){let s=new tn,i=[],r=new Map,o=[],a=new Map,l=new Map,c=new Map,h=new Set;this.disabledNodes.forEach(g=>{h.add(g);let E=this.driver.query(g,qh,!0);for(let w=0;w<E.length;w++)h.add(E[w])});let u=this.bodyNode,d=Array.from(this.statesByElement.keys()),p=Ka(d,this.collectedEnterElements),f=new Map,m=0;p.forEach((g,E)=>{let w=Ks+m++;f.set(E,w),g.forEach(R=>de(R,w))});let v=[],P=new Set,D=new Set;for(let g=0;g<this.collectedLeaveElements.length;g++){let E=this.collectedLeaveElements[g],w=E[we];w&&w.setForRemoval&&(v.push(E),P.add(E),w.hasAnimation?this.driver.query(E,jh,!0).forEach(R=>P.add(R)):D.add(E))}let k=new Map,C=Ka(d,Array.from(P));C.forEach((g,E)=>{let w=Vn+m++;k.set(E,w),g.forEach(R=>de(R,w))}),e.push(()=>{p.forEach((g,E)=>{let w=f.get(E);g.forEach(R=>Nt(R,w))}),C.forEach((g,E)=>{let w=k.get(E);g.forEach(R=>Nt(R,w))}),v.forEach(g=>{this.processLeaveNode(g)})});let Z=[],K=[];for(let g=this._namespaceList.length-1;g>=0;g--)this._namespaceList[g].drainQueuedTransitions(t).forEach(w=>{let R=w.player,V=w.element;if(Z.push(R),this.collectedEnterElements.length){let H=V[we];if(H&&H.setForMove){if(H.previousTriggersValues&&H.previousTriggersValues.has(w.triggerName)){let Je=H.previousTriggersValues.get(w.triggerName),ue=this.statesByElement.get(w.element);if(ue&&ue.has(w.triggerName)){let kn=ue.get(w.triggerName);kn.value=Je,ue.set(w.triggerName,kn)}}R.destroy();return}}let Ce=!u||!this.driver.containsElement(u,V),oe=k.get(V),xe=f.get(V),x=this._buildInstruction(w,s,xe,oe,Ce);if(x.errors&&x.errors.length){K.push(x);return}if(Ce){R.onStart(()=>Ge(V,x.fromStyles)),R.onDestroy(()=>Ee(V,x.toStyles)),i.push(R);return}if(w.isFallbackTransition){R.onStart(()=>Ge(V,x.fromStyles)),R.onDestroy(()=>Ee(V,x.toStyles)),i.push(R);return}let so=[];x.timelines.forEach(H=>{H.stretchStartingKeyframe=!0,this.disabledNodes.has(H.element)||so.push(H)}),x.timelines=so,s.append(V,x.timelines);let ah={instruction:x,player:R,element:V};o.push(ah),x.queriedElements.forEach(H=>ne(a,H,[]).push(R)),x.preStyleProps.forEach((H,Je)=>{if(H.size){let ue=l.get(Je);ue||l.set(Je,ue=new Set),H.forEach((kn,Ns)=>ue.add(Ns))}}),x.postStyleProps.forEach((H,Je)=>{let ue=c.get(Je);ue||c.set(Je,ue=new Set),H.forEach((kn,Ns)=>ue.add(Ns))})});if(K.length){let g=[];K.forEach(E=>{g.push(Oa(E.triggerName,E.errors))}),Z.forEach(E=>E.destroy()),this.reportError(g)}let $=new Map,S=new Map;o.forEach(g=>{let E=g.element;s.has(E)&&(S.set(E,E),this._beforeAnimationBuild(g.player.namespaceId,g.instruction,$))}),i.forEach(g=>{let E=g.element;this._getPreviousPlayers(E,!1,g.namespaceId,g.triggerName,null).forEach(R=>{ne($,E,[]).push(R),R.destroy()})});let B=v.filter(g=>Ga(g,l,c)),z=new Map;za(z,this.driver,D,c,ve).forEach(g=>{Ga(g,l,c)&&B.push(g)});let G=new Map;p.forEach((g,E)=>{za(G,this.driver,new Set(g),l,Qt)}),B.forEach(g=>{let E=z.get(g),w=G.get(g);z.set(g,new Map([...E?.entries()??[],...w?.entries()??[]]))});let J=[],Qe=[],Xe={};o.forEach(g=>{let{element:E,player:w,instruction:R}=g;if(s.has(E)){if(h.has(E)){w.onDestroy(()=>Ee(E,R.toStyles)),w.disabled=!0,w.overrideTotalTime(R.totalTime),i.push(w);return}let V=Xe;if(S.size>1){let oe=E,xe=[];for(;oe=oe.parentNode;){let x=S.get(oe);if(x){V=x;break}xe.push(oe)}xe.forEach(x=>S.set(x,V))}let Ce=this._buildAnimation(w.namespaceId,R,$,r,G,z);if(w.setRealPlayer(Ce),V===Xe)J.push(w);else{let oe=this.playersByElement.get(V);oe&&oe.length&&(w.parentPlayer=Oe(oe)),i.push(w)}}else Ge(E,R.fromStyles),w.onDestroy(()=>Ee(E,R.toStyles)),Qe.push(w),h.has(E)&&i.push(w)}),Qe.forEach(g=>{let E=r.get(g.element);if(E&&E.length){let w=Oe(E);g.setRealPlayer(w)}}),i.forEach(g=>{g.parentPlayer?g.syncPlayerEvents(g.parentPlayer):g.destroy()});for(let g=0;g<v.length;g++){let E=v[g],w=E[we];if(Nt(E,Vn),w&&w.hasAnimation)continue;let R=[];if(a.size){let Ce=a.get(E);Ce&&Ce.length&&R.push(...Ce);let oe=this.driver.query(E,Wn,!0);for(let xe=0;xe<oe.length;xe++){let x=a.get(oe[xe]);x&&x.length&&R.push(...x)}}let V=R.filter(Ce=>!Ce.destroyed);V.length?Qh(this,E,V):this.processLeaveNode(E)}return v.length=0,J.forEach(g=>{this.players.push(g),g.onDone(()=>{g.destroy();let E=this.players.indexOf(g);this.players.splice(E,1)}),g.play()}),J}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,s,i,r){let o=[];if(t){let a=this.playersByQueriedElement.get(e);a&&(o=a)}else{let a=this.playersByElement.get(e);if(a){let l=!r||r==en;a.forEach(c=>{c.queued||!l&&c.triggerName!=i||o.push(c)})}}return(s||i)&&(o=o.filter(a=>!(s&&s!=a.namespaceId||i&&i!=a.triggerName))),o}_beforeAnimationBuild(e,t,s){let i=t.triggerName,r=t.element,o=t.isRemovalTransition?void 0:e,a=t.isRemovalTransition?void 0:i;for(let l of t.timelines){let c=l.element,h=c!==r,u=ne(s,c,[]);this._getPreviousPlayers(c,h,o,a,t.toState).forEach(p=>{let f=p.getRealPlayer();f.beforeDestroy&&f.beforeDestroy(),p.destroy(),u.push(p)})}Ge(r,t.fromStyles)}_buildAnimation(e,t,s,i,r,o){let a=t.triggerName,l=t.element,c=[],h=new Set,u=new Set,d=t.timelines.map(f=>{let m=f.element;h.add(m);let v=m[we];if(v&&v.removedBeforeQueried)return new ke(f.duration,f.delay);let P=m!==l,D=Xh((s.get(m)||zh).map($=>$.getRealPlayer())).filter($=>{let S=$;return S.element?S.element===m:!1}),k=r.get(m),C=o.get(m),Z=qs(this._normalizer,f.keyframes,k,C),K=this._buildPlayer(f,Z,D);if(f.subTimeline&&i&&u.add(m),P){let $=new sn(e,a,m);$.setRealPlayer(K),c.push($)}return K});c.forEach(f=>{ne(this.playersByQueriedElement,f.element,[]).push(f),f.onDone(()=>Gh(this.playersByQueriedElement,f.element,f))}),h.forEach(f=>de(f,Gs));let p=Oe(d);return p.onDestroy(()=>{h.forEach(f=>Nt(f,Gs)),Ee(l,t.toStyles)}),u.forEach(f=>{ne(i,f,[]).push(p)}),p}_buildPlayer(e,t,s){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,s):new ke(e.duration,e.delay)}},sn=class{namespaceId;triggerName;element;_player=new ke;_containsRealPlayer=!1;_queuedCallbacks=new Map;destroyed=!1;parentPlayer=null;markedForDestroy=!1;disabled=!1;queued=!0;totalTime=0;constructor(e,t,s){this.namespaceId=e,this.triggerName=t,this.element=s}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,s)=>{t.forEach(i=>Bn(e,s,void 0,i))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){let t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){ne(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){let t=this._player;t.triggerCallback&&t.triggerCallback(e)}};function Gh(n,e,t){let s=n.get(e);if(s){if(s.length){let i=s.indexOf(t);s.splice(i,1)}s.length==0&&n.delete(e)}return s}function Hh(n){return n??null}function Hn(n){return n&&n.nodeType===1}function Yh(n){return n=="start"||n=="done"}function ja(n,e){let t=n.style.display;return n.style.display=e??"none",t}function za(n,e,t,s,i){let r=[];t.forEach(l=>r.push(ja(l)));let o=[];s.forEach((l,c)=>{let h=new Map;l.forEach(u=>{let d=e.computeStyle(c,u,i);h.set(u,d),(!d||d.length==0)&&(c[we]=Kh,o.push(c))}),n.set(c,h)});let a=0;return t.forEach(l=>ja(l,r[a++])),o}function Ka(n,e){let t=new Map;if(n.forEach(a=>t.set(a,[])),e.length==0)return t;let s=1,i=new Set(e),r=new Map;function o(a){if(!a)return s;let l=r.get(a);if(l)return l;let c=a.parentNode;return t.has(c)?l=c:i.has(c)?l=s:l=o(c),r.set(a,l),l}return e.forEach(a=>{let l=o(a);l!==s&&t.get(l).push(a)}),t}function de(n,e){n.classList?.add(e)}function Nt(n,e){n.classList?.remove(e)}function Qh(n,e,t){Oe(t).onDone(()=>n.processLeaveNode(e))}function Xh(n){let e=[];return el(n,e),e}function el(n,e){for(let t=0;t<n.length;t++){let s=n[t];s instanceof It?el(s.players,e):e.push(s)}}function Jh(n,e){let t=Object.keys(n),s=Object.keys(e);if(t.length!=s.length)return!1;for(let i=0;i<t.length;i++){let r=t[i];if(!e.hasOwnProperty(r)||n[r]!==e[r])return!1}return!0}function Ga(n,e,t){let s=t.get(n);if(!s)return!1;let i=e.get(n);return i?s.forEach(r=>i.add(r)):e.set(n,s),t.delete(n),!0}var Pt=class{_driver;_normalizer;_transitionEngine;_timelineEngine;_triggerCache={};onRemovalComplete=(e,t)=>{};constructor(e,t,s){this._driver=t,this._normalizer=s,this._transitionEngine=new ci(e.body,t,s),this._timelineEngine=new ai(e.body,t,s),this._transitionEngine.onRemovalComplete=(i,r)=>this.onRemovalComplete(i,r)}registerTrigger(e,t,s,i,r){let o=e+"-"+i,a=this._triggerCache[o];if(!a){let l=[],c=[],h=Qa(this._driver,r,l,c);if(l.length)throw Ta(i,l);a=Uh(i,h,this._normalizer),this._triggerCache[o]=a}this._transitionEngine.registerTrigger(t,i,a)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,s,i){this._transitionEngine.insertNode(e,t,s,i)}onRemove(e,t,s){this._transitionEngine.removeNode(e,t,s)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,s,i){if(s.charAt(0)=="@"){let[r,o]=Vs(s),a=i;this._timelineEngine.command(r,t,o,a)}else this._transitionEngine.trigger(e,t,s,i)}listen(e,t,s,i,r){if(s.charAt(0)=="@"){let[o,a]=Vs(s);return this._timelineEngine.listen(o,t,a,r)}return this._transitionEngine.listen(e,t,s,i,r)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(e){this._transitionEngine.afterFlushAnimationsDone(e)}};function Zh(n,e){let t=null,s=null;return Array.isArray(e)&&e.length?(t=Zs(e[0]),e.length>1&&(s=Zs(e[e.length-1]))):e instanceof Map&&(t=Zs(e)),t||s?new ed(n,t,s):null}var ed=(()=>{class n{_element;_startStyles;_endStyles;static initialStylesByElement=new WeakMap;_state=0;_initialStyles;constructor(t,s,i){this._element=t,this._startStyles=s,this._endStyles=i;let r=n.initialStylesByElement.get(t);r||n.initialStylesByElement.set(t,r=new Map),this._initialStyles=r}start(){this._state<1&&(this._startStyles&&Ee(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Ee(this._element,this._initialStyles),this._endStyles&&(Ee(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(Ge(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Ge(this._element,this._endStyles),this._endStyles=null),Ee(this._element,this._initialStyles),this._state=3)}}return n})();function Zs(n){let e=null;return n.forEach((t,s)=>{td(s)&&(e=e||new Map,e.set(s,t))}),e}function td(n){return n==="display"||n==="position"}var ts=class{element;keyframes;options;_specialStyles;_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_duration;_delay;_initialized=!1;_finished=!1;_started=!1;_destroyed=!1;_finalKeyframe;_originalOnDoneFns=[];_originalOnStartFns=[];domPlayer=null;time=0;parentPlayer=null;currentSnapshot=new Map;constructor(e,t,s,i){this.element=e,this.keyframes=t,this.options=s,this._specialStyles=i,this._duration=s.duration,this._delay=s.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer()&&this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return this.domPlayer;this._initialized=!0;let e=this.keyframes,t=this._triggerWebAnimation(this.element,e,this.options);if(!t)return this._onFinish(),null;this.domPlayer=t,this._finalKeyframe=e.length?e[e.length-1]:new Map;let s=()=>this._onFinish();return t.addEventListener("finish",s),this.onDestroy(()=>{t.removeEventListener("finish",s)}),t}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer?.pause()}_convertKeyframesToObject(e){let t=[];return e.forEach(s=>{t.push(Object.fromEntries(s))}),t}_triggerWebAnimation(e,t,s){let i=this._convertKeyframesToObject(t);try{return e.animate(i,s)}catch{return null}}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){let e=this._buildPlayer();e&&(this.hasStarted()||(this._onStartFns.forEach(t=>t()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),e.play())}pause(){this.init(),this.domPlayer?.pause()}finish(){this.init(),this.domPlayer&&(this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish())}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer?.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){this.domPlayer||this.init(),this.domPlayer&&(this.domPlayer.currentTime=e*this.time)}getPosition(){return this.domPlayer?+(this.domPlayer.currentTime??0)/this.time:this._initialized?1:0}get totalTime(){return this._delay+this._duration}beforeDestroy(){let e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((s,i)=>{i!=="offset"&&e.set(i,this._finished?s:zn(this.element,i))}),this.currentSnapshot=e}triggerCallback(e){let t=e==="start"?this._onStartFns:this._onDoneFns;t.forEach(s=>s()),t.length=0}},ns=class{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}containsElement(e,t){return Ws(e,t)}getParentElement(e){return qn(e)}query(e,t,s){return js(e,t,s)}computeStyle(e,t,s){return zn(e,t)}animate(e,t,s,i,r,o=[]){let a=i==0?"both":"forwards",l={duration:s,delay:i,fill:a};r&&(l.easing=r);let c=new Map,h=o.filter(p=>p instanceof ts);La(s,i)&&h.forEach(p=>{p.currentSnapshot.forEach((f,m)=>c.set(m,f))});let u=Ma(t).map(p=>new Map(p));u=xa(e,u,c);let d=Zh(e,u);return new ts(e,u,l,d)}};var Yn="@",tl="@.disabled",ss=class{namespaceId;delegate;engine;_onDestroy;\u0275type=0;constructor(e,t,s,i){this.namespaceId=e,this.delegate=t,this.engine=s,this._onDestroy=i}get data(){return this.delegate.data}destroyNode(e){this.delegate.destroyNode?.(e)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,s,i=!0){this.delegate.insertBefore(e,t,s),this.engine.onInsert(this.namespaceId,t,e,i)}removeChild(e,t,s,i){if(i){this.delegate.removeChild(e,t,s,i);return}this.parentNode(t)&&this.engine.onRemove(this.namespaceId,t,this.delegate)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,s,i){this.delegate.setAttribute(e,t,s,i)}removeAttribute(e,t,s){this.delegate.removeAttribute(e,t,s)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,s,i){this.delegate.setStyle(e,t,s,i)}removeStyle(e,t,s){this.delegate.removeStyle(e,t,s)}setProperty(e,t,s){t.charAt(0)==Yn&&t==tl?this.disableAnimations(e,!!s):this.delegate.setProperty(e,t,s)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,s,i){return this.delegate.listen(e,t,s,i)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}},ui=class extends ss{factory;constructor(e,t,s,i,r){super(t,s,i,r),this.factory=e,this.namespaceId=t}setProperty(e,t,s){t.charAt(0)==Yn?t.charAt(1)=="."&&t==tl?(s=s===void 0?!0:!!s,this.disableAnimations(e,s)):this.engine.process(this.namespaceId,e,t.slice(1),s):this.delegate.setProperty(e,t,s)}listen(e,t,s,i){if(t.charAt(0)==Yn){let r=nd(e),o=t.slice(1),a="";return o.charAt(0)!=Yn&&([o,a]=sd(o)),this.engine.listen(this.namespaceId,r,o,a,l=>{let c=l._data||-1;this.factory.scheduleListenerCallback(c,s,l)})}return this.delegate.listen(e,t,s,i)}};function nd(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}function sd(n){let e=n.indexOf("."),t=n.substring(0,e),s=n.slice(e+1);return[t,s]}var is=class{delegate;engine;_zone;_currentId=0;_microtaskId=1;_animationCallbacksBuffer=[];_rendererCache=new Map;_cdRecurDepth=0;constructor(e,t,s){this.delegate=e,this.engine=t,this._zone=s,t.onRemovalComplete=(i,r)=>{r?.removeChild(null,i)}}createRenderer(e,t){let i=this.delegate.createRenderer(e,t);if(!e||!t?.data?.animation){let c=this._rendererCache,h=c.get(i);if(!h){let u=()=>c.delete(i);h=new ss("",i,this.engine,u),c.set(i,h)}return h}let r=t.id,o=t.id+"-"+this._currentId;this._currentId++,this.engine.register(o,e);let a=c=>{Array.isArray(c)?c.forEach(a):this.engine.registerTrigger(r,o,e,c.name,c)};return t.data.animation.forEach(a),new ui(this,o,i,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,s){if(e>=0&&e<this._microtaskId){this._zone.run(()=>t(s));return}let i=this._animationCallbacksBuffer;i.length==0&&queueMicrotask(()=>{this._zone.run(()=>{i.forEach(r=>{let[o,a]=r;o(a)}),this._animationCallbacksBuffer=[]})}),i.push([t,s])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}componentReplaced(e){this.engine.flush(),this.delegate.componentReplaced?.(e)}};var rd=(()=>{class n extends Pt{constructor(t,s,i){super(t,s,i)}ngOnDestroy(){this.flush()}static \u0275fac=function(s){return new(s||n)(Dn(ro),Dn(rt),Dn(ot))};static \u0275prov=On({token:n,factory:n.\u0275fac})}return n})();function od(){return new Qn}function ad(n,e,t){return new is(n,e,t)}var nl=[{provide:ot,useFactory:od},{provide:Pt,useClass:rd},{provide:ao,useFactory:ad,deps:[po,Pt,ge]}],mg=[{provide:rt,useClass:hi},{provide:Ps,useValue:"NoopAnimations"},...nl],ld=[{provide:rt,useFactory:()=>new ns},{provide:Ps,useFactory:()=>"BrowserAnimations"},...nl];function sl(){return oo("NgEagerAnimations"),[...ld]}var il=[{path:"",loadComponent:()=>import("./chunk-66MTVSTF.js").then(n=>n.HomePage)},{path:"profile-user",loadComponent:()=>import("./chunk-XJHLGWLB.js").then(n=>n.ProfileUserPage)},{path:"**",redirectTo:""}];var rn={production:!0,staging:!1,firebaseConfig:{apiKey:"AIzaSyDgQBh83A2rTCsThPEvEHCQqdwEp7Wo-xg",authDomain:"ai-fitness-f8ed4.firebaseapp.com",databaseURL:"https:/ai-fitness-f8ed4-default-rtdb.firebaseio.com/",projectId:"ai-fitness-f8ed4",storageBucket:"ai-fitness-f8ed4.firebasestorage.app",messagingSenderId:"331636214459",appId:"1:331636214459:web:5508ada3115c4fe86d779e",measurementId:"G-1YF7X3YMXV"},stripePublicKey:"67",cloudFunctionsBaseUrl:"",appVersion:"1.0"};var rl=(()=>{let e=class e{constructor(s){this.devSeedService=s}ngOnInit(){return y(this,null,function*(){if(console.log("[AppComponent] ngOnInit"),rn.production)console.log("[AppComponent] Skipping dev seed (production env).");else{console.log("[AppComponent] Running dev seed...");try{yield this.devSeedService.ensureDevUserAndSeed(),console.log("[AppComponent] Dev seed finished.")}catch(s){console.error("[AppComponent] Dev seed failed:",s)}}})}};e.\u0275fac=function(i){return new(i||e)(lo(ia))},e.\u0275cmp=co({type:e,selectors:[["app-root"]],decls:2,vars:0,template:function(i,r){i&1&&(uo(0,"ion-app"),fo(1,"ion-router-outlet"),ho())},dependencies:[So,To],encapsulation:2});let n=e;return n})();var ll="@firebase/installations",_i="0.6.18";var cl=1e4,ul=`w:${_i}`,hl="FIS_v2",cd="https://firebaseinstallations.googleapis.com/v1",ud=3600*1e3,hd="installations",dd="Installations";var fd={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},lt=new tt(hd,dd,fd);function dl(n){return n instanceof et&&n.code.includes("request-failed")}function fl({projectId:n}){return`${cd}/projects/${n}/installations`}function pl(n){return{token:n.token,requestStatus:2,expiresIn:md(n.expiresIn),creationTime:Date.now()}}function ml(n,e){return y(this,null,function*(){let s=(yield e.json()).error;return lt.create("request-failed",{requestName:n,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})})}function _l({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function pd(n,{refreshToken:e}){let t=_l(n);return t.append("Authorization",_d(e)),t}function gl(n){return y(this,null,function*(){let e=yield n();return e.status>=500&&e.status<600?n():e})}function md(n){return Number(n.replace("s","000"))}function _d(n){return`${hl} ${n}`}function gd(s,i){return y(this,arguments,function*({appConfig:n,heartbeatServiceProvider:e},{fid:t}){let r=fl(n),o=_l(n),a=e.getImmediate({optional:!0});if(a){let u=yield a.getHeartbeatsHeader();u&&o.append("x-firebase-client",u)}let l={fid:t,authVersion:hl,appId:n.appId,sdkVersion:ul},c={method:"POST",headers:o,body:JSON.stringify(l)},h=yield gl(()=>fetch(r,c));if(h.ok){let u=yield h.json();return{fid:u.fid||t,registrationStatus:2,refreshToken:u.refreshToken,authToken:pl(u.authToken)}}else throw yield ml("Create Installation",h)})}function yl(n){return new Promise(e=>{setTimeout(e,n)})}function yd(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}var vd=/^[cdef][\w-]{21}$/,mi="";function Ed(){try{let n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;let t=wd(n);return vd.test(t)?t:mi}catch{return mi}}function wd(n){return yd(n).substr(0,22)}function os(n){return`${n.appName}!${n.appId}`}var vl=new Map;function El(n,e){let t=os(n);wl(t,e),Td(t,e)}function wl(n,e){let t=vl.get(n);if(t)for(let s of t)s(e)}function Td(n,e){let t=Sd();t&&t.postMessage({key:n,fid:e}),bd()}var at=null;function Sd(){return!at&&"BroadcastChannel"in self&&(at=new BroadcastChannel("[Firebase] FID Change"),at.onmessage=n=>{wl(n.data.key,n.data.fid)}),at}function bd(){vl.size===0&&at&&(at.close(),at=null)}var Cd="firebase-installations-database",Id=1,ct="firebase-installations-store",fi=null;function gi(){return fi||(fi=Vo(Cd,Id,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(ct)}}})),fi}function rs(n,e){return y(this,null,function*(){let t=os(n),i=(yield gi()).transaction(ct,"readwrite"),r=i.objectStore(ct),o=yield r.get(t);return yield r.put(e,t),yield i.done,(!o||o.fid!==e.fid)&&El(n,e.fid),e})}function Tl(n){return y(this,null,function*(){let e=os(n),s=(yield gi()).transaction(ct,"readwrite");yield s.objectStore(ct).delete(e),yield s.done})}function as(n,e){return y(this,null,function*(){let t=os(n),i=(yield gi()).transaction(ct,"readwrite"),r=i.objectStore(ct),o=yield r.get(t),a=e(o);return a===void 0?yield r.delete(t):yield r.put(a,t),yield i.done,a&&(!o||o.fid!==a.fid)&&El(n,a.fid),a})}function yi(n){return y(this,null,function*(){let e,t=yield as(n.appConfig,s=>{let i=Ad(s),r=Rd(n,i);return e=r.registrationPromise,r.installationEntry});return t.fid===mi?{installationEntry:yield e}:{installationEntry:t,registrationPromise:e}})}function Ad(n){let e=n||{fid:Ed(),registrationStatus:0};return Sl(e)}function Rd(n,e){if(e.registrationStatus===0){if(!navigator.onLine){let i=Promise.reject(lt.create("app-offline"));return{installationEntry:e,registrationPromise:i}}let t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},s=Nd(n,t);return{installationEntry:t,registrationPromise:s}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:Pd(n)}:{installationEntry:e}}function Nd(n,e){return y(this,null,function*(){try{let t=yield gd(n,e);return rs(n.appConfig,t)}catch(t){throw dl(t)&&t.customData.serverCode===409?yield Tl(n.appConfig):yield rs(n.appConfig,{fid:e.fid,registrationStatus:0}),t}})}function Pd(n){return y(this,null,function*(){let e=yield ol(n.appConfig);for(;e.registrationStatus===1;)yield yl(100),e=yield ol(n.appConfig);if(e.registrationStatus===0){let{installationEntry:t,registrationPromise:s}=yield yi(n);return s||t}return e})}function ol(n){return as(n,e=>{if(!e)throw lt.create("installation-not-found");return Sl(e)})}function Sl(n){return kd(n)?{fid:n.fid,registrationStatus:0}:n}function kd(n){return n.registrationStatus===1&&n.registrationTime+cl<Date.now()}function Od(s,i){return y(this,arguments,function*({appConfig:n,heartbeatServiceProvider:e},t){let r=Dd(n,t),o=pd(n,t),a=e.getImmediate({optional:!0});if(a){let u=yield a.getHeartbeatsHeader();u&&o.append("x-firebase-client",u)}let l={installation:{sdkVersion:ul,appId:n.appId}},c={method:"POST",headers:o,body:JSON.stringify(l)},h=yield gl(()=>fetch(r,c));if(h.ok){let u=yield h.json();return pl(u)}else throw yield ml("Generate Auth Token",h)})}function Dd(n,{fid:e}){return`${fl(n)}/${e}/authTokens:generate`}function vi(n,e=!1){return y(this,null,function*(){let t,s=yield as(n.appConfig,r=>{if(!bl(r))throw lt.create("not-registered");let o=r.authToken;if(!e&&Ld(o))return r;if(o.requestStatus===1)return t=Md(n,e),r;{if(!navigator.onLine)throw lt.create("app-offline");let a=Ud(r);return t=Fd(n,a),a}});return t?yield t:s.authToken})}function Md(n,e){return y(this,null,function*(){let t=yield al(n.appConfig);for(;t.authToken.requestStatus===1;)yield yl(100),t=yield al(n.appConfig);let s=t.authToken;return s.requestStatus===0?vi(n,e):s})}function al(n){return as(n,e=>{if(!bl(e))throw lt.create("not-registered");let t=e.authToken;return Bd(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function Fd(n,e){return y(this,null,function*(){try{let t=yield Od(n,e),s=Object.assign(Object.assign({},e),{authToken:t});return yield rs(n.appConfig,s),t}catch(t){if(dl(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))yield Tl(n.appConfig);else{let s=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});yield rs(n.appConfig,s)}throw t}})}function bl(n){return n!==void 0&&n.registrationStatus===2}function Ld(n){return n.requestStatus===2&&!xd(n)}function xd(n){let e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+ud}function Ud(n){let e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function Bd(n){return n.requestStatus===1&&n.requestTime+cl<Date.now()}function $d(n){return y(this,null,function*(){let e=n,{installationEntry:t,registrationPromise:s}=yield yi(e);return s?s.catch(console.error):vi(e).catch(console.error),t.fid})}function qd(n,e=!1){return y(this,null,function*(){let t=n;return yield Vd(t),(yield vi(t,e)).token})}function Vd(n){return y(this,null,function*(){let{registrationPromise:e}=yield yi(n);e&&(yield e)})}function Wd(n){if(!n||!n.options)throw pi("App Configuration");if(!n.name)throw pi("App Name");let e=["projectId","apiKey","appId"];for(let t of e)if(!n.options[t])throw pi(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function pi(n){return lt.create("missing-app-config-values",{valueName:n})}var Cl="installations",jd="installations-internal",zd=n=>{let e=n.getProvider("app").getImmediate(),t=Wd(e),s=he(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:s,_delete:()=>Promise.resolve()}},Kd=n=>{let e=n.getProvider("app").getImmediate(),t=he(e,Cl).getImmediate();return{getId:()=>$d(t),getToken:i=>qd(t,i)}};function Gd(){te(new ee(Cl,zd,"PUBLIC")),te(new ee(jd,Kd,"PRIVATE"))}Gd();M(ll,_i);M(ll,_i,"esm2017");var ls="analytics",Hd="firebase_id",Yd="origin",Qd=60*1e3,Xd="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Ii="https://www.googletagmanager.com/gtag/js";var ie=new wt("@firebase/analytics");var Jd={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},le=new tt("analytics","Analytics",Jd);function Zd(n){if(!n.startsWith(Ii)){let e=le.create("invalid-gtag-resource",{gtagURL:n});return ie.warn(e.message),""}return n}function Ol(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function ef(n,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(n,e)),t}function tf(n,e){let t=ef("firebase-js-sdk-policy",{createScriptURL:Zd}),s=document.createElement("script"),i=`${Ii}?l=${n}&id=${e}`;s.src=t?t?.createScriptURL(i):i,s.async=!0,document.head.appendChild(s)}function nf(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}function sf(n,e,t,s,i,r){return y(this,null,function*(){let o=s[i];try{if(o)yield e[o];else{let l=(yield Ol(t)).find(c=>c.measurementId===i);l&&(yield e[l.appId])}}catch(a){ie.error(a)}n("config",i,r)})}function rf(n,e,t,s,i){return y(this,null,function*(){try{let r=[];if(i&&i.send_to){let o=i.send_to;Array.isArray(o)||(o=[o]);let a=yield Ol(t);for(let l of o){let c=a.find(u=>u.measurementId===l),h=c&&e[c.appId];if(h)r.push(h);else{r=[];break}}}r.length===0&&(r=Object.values(e)),yield Promise.all(r),n("event",s,i||{})}catch(r){ie.error(r)}})}function of(n,e,t,s){function i(r,...o){return y(this,null,function*(){try{if(r==="event"){let[a,l]=o;yield rf(n,e,t,a,l)}else if(r==="config"){let[a,l]=o;yield sf(n,e,t,s,a,l)}else if(r==="consent"){let[a,l]=o;n("consent",a,l)}else if(r==="get"){let[a,l,c]=o;n("get",a,l,c)}else if(r==="set"){let[a]=o;n("set",a)}else n(r,...o)}catch(a){ie.error(a)}})}return i}function af(n,e,t,s,i){let r=function(...o){window[s].push(arguments)};return window[i]&&typeof window[i]=="function"&&(r=window[i]),window[i]=of(r,n,e,t),{gtagCore:r,wrappedGtag:window[i]}}function lf(n){let e=window.document.getElementsByTagName("script");for(let t of Object.values(e))if(t.src&&t.src.includes(Ii)&&t.src.includes(n))return t;return null}var cf=30,uf=1e3,wi=class{constructor(e={},t=uf){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}},Dl=new wi;function hf(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}function df(n){return y(this,null,function*(){var e;let{appId:t,apiKey:s}=n,i={method:"GET",headers:hf(s)},r=Xd.replace("{app-id}",t),o=yield fetch(r,i);if(o.status!==200&&o.status!==304){let a="";try{let l=yield o.json();!((e=l.error)===null||e===void 0)&&e.message&&(a=l.error.message)}catch{}throw le.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()})}function ff(s){return y(this,arguments,function*(n,e=Dl,t){let{appId:i,apiKey:r,measurementId:o}=n.options;if(!i)throw le.create("no-app-id");if(!r){if(o)return{measurementId:o,appId:i};throw le.create("no-api-key")}let a=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},l=new Ti;return setTimeout(()=>y(null,null,function*(){l.abort()}),t!==void 0?t:Qd),Ml({appId:i,apiKey:r,measurementId:o},a,l,e)})}function Ml(r,o,a){return y(this,arguments,function*(n,{throttleEndTimeMillis:e,backoffCount:t},s,i=Dl){var l;let{appId:c,measurementId:h}=n;try{yield pf(s,e)}catch(u){if(h)return ie.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${h} provided in the "measurementId" field in the local Firebase config. [${u?.message}]`),{appId:c,measurementId:h};throw u}try{let u=yield df(n);return i.deleteThrottleMetadata(c),u}catch(u){let d=u;if(!mf(d)){if(i.deleteThrottleMetadata(c),h)return ie.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${h} provided in the "measurementId" field in the local Firebase config. [${d?.message}]`),{appId:c,measurementId:h};throw u}let p=Number((l=d?.customData)===null||l===void 0?void 0:l.httpStatus)===503?Fs(t,i.intervalMillis,cf):Fs(t,i.intervalMillis),f={throttleEndTimeMillis:Date.now()+p,backoffCount:t+1};return i.setThrottleMetadata(c,f),ie.debug(`Calling attemptFetch again in ${p} millis`),Ml(n,f,s,i)}})}function pf(n,e){return new Promise((t,s)=>{let i=Math.max(e-Date.now(),0),r=setTimeout(t,i);n.addEventListener(()=>{clearTimeout(r),s(le.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function mf(n){if(!(n instanceof et)||!n.customData)return!1;let e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}var Ti=class{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}};var Si;function _f(n,e,t,s,i){return y(this,null,function*(){if(i&&i.global){n("event",t,s);return}else{let r=yield e,o=Object.assign(Object.assign({},s),{send_to:r});n("event",t,o)}})}var bi;function gf(n){bi=n}function yf(n){Si=n}function vf(){return y(this,null,function*(){if(ko())try{yield Oo()}catch(n){return ie.warn(le.create("indexeddb-unavailable",{errorInfo:n?.toString()}).message),!1}else return ie.warn(le.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0})}function Ef(n,e,t,s,i,r,o){return y(this,null,function*(){var a;let l=ff(n);l.then(p=>{t[p.measurementId]=p.appId,n.options.measurementId&&p.measurementId!==n.options.measurementId&&ie.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${p.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(p=>ie.error(p)),e.push(l);let c=vf().then(p=>{if(p)return s.getId()}),[h,u]=yield Promise.all([l,c]);lf(r)||tf(r,h.measurementId),bi&&(i("consent","default",bi),gf(void 0)),i("js",new Date);let d=(a=o?.config)!==null&&a!==void 0?a:{};return d[Yd]="firebase",d.update=!0,u!=null&&(d[Hd]=u),i("config",h.measurementId,d),Si&&(i("set",Si),yf(void 0)),h.measurementId})}var Ci=class{constructor(e){this.app=e}_delete(){return delete on[this.app.options.appId],Promise.resolve()}},on={},Il=[],Al={},Ei="dataLayer",wf="gtag",Rl,Fl,Nl=!1;function Tf(){let n=[];if(No()&&n.push("This is a browser extension environment."),Do()||n.push("Cookies are not available."),n.length>0){let e=n.map((s,i)=>`(${i+1}) ${s}`).join(" "),t=le.create("invalid-analytics-context",{errorInfo:e});ie.warn(t.message)}}function Sf(n,e,t){Tf();let s=n.options.appId;if(!s)throw le.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)ie.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw le.create("no-api-key");if(on[s]!=null)throw le.create("already-exists",{id:s});if(!Nl){nf(Ei);let{wrappedGtag:r,gtagCore:o}=af(on,Il,Al,Ei,wf);Fl=r,Rl=o,Nl=!0}return on[s]=Ef(n,Il,Al,e,Rl,Ei,t),new Ci(n)}function Ll(n=Pe()){n=ye(n);let e=he(n,ls);return e.isInitialized()?e.getImmediate():xl(n)}function xl(n,e={}){let t=he(n,ls);if(t.isInitialized()){let i=t.getImmediate();if(Un(e,t.getOptions()))return i;throw le.create("already-initialized")}return t.initialize({options:e})}function Ul(n,e,t,s){n=ye(n),_f(Fl,on[n.app.options.appId],e,t,s).catch(i=>ie.error(i))}var Pl="@firebase/analytics",kl="0.10.17";function bf(){te(new ee(ls,(e,{options:t})=>{let s=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();return Sf(s,i,t)},"PUBLIC")),te(new ee("analytics-internal",n,"PRIVATE")),M(Pl,kl),M(Pl,kl,"esm2017");function n(e){try{let t=e.getProvider(ls).getImmediate();return{logEvent:(s,i,r)=>Ul(t,s,i,r)}}catch(t){throw le.create("interop-component-reg-failed",{reason:t})}}}bf();var an=class{constructor(e){return e}},Bl="analytics",Ai=class{constructor(){return Ve(Bl)}};var $l=je(Ll,!0);var sy=Math.floor(Math.random()*(2**32-1))-2**31;var Ri=new Ie("angularfire2.analytics-instances");function Cf(n,e,t){if(!ks(t))return null;let s=qe(Bl,n,e);return s&&new an(s)}function If(n){return(e,t,s)=>{if(!ks(s))return null;let i=e.runOutsideAngular(()=>n(t));return new an(i)}}var Af={provide:Ai,deps:[[new q,Ri]]},Rf={provide:an,useFactory:Cf,deps:[[new q,Ri],ze,Mn]};function ql(n,...e){return M("angularfire",$e.full,"analytics"),Ue([Rf,Af,{provide:Ri,useFactory:If(n),multi:!0,deps:[ge,Be,Mn,We,Ke,...e]}])}var Ni=class{constructor(e,t){this._delegate=e,this.firebase=t,Ls(e,new ee("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),zo(this._delegate)))}_getService(e,t=Yt){var s;this._delegate.checkDestroyed();let i=this._delegate.container.getProvider(e);return!i.isInitialized()&&((s=i.getComponent())===null||s===void 0?void 0:s.instantiationMode)==="EXPLICIT"&&i.initialize(),i.getImmediate({identifier:t})}_removeServiceInstance(e,t=Yt){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Ls(this._delegate,e)}_addOrOverwriteComponent(e){Wo(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}};var Nf={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},Vl=new tt("app-compat","Firebase",Nf);function Pf(n){let e={},t={__esModule:!0,initializeApp:r,app:i,registerVersion:M,setLogLevel:Go,onLog:Ko,apps:null,SDK_VERSION:St,INTERNAL:{registerComponent:a,removeApp:s,useAsService:l,modularAPIs:Ho}};t.default=t,Object.defineProperty(t,"apps",{get:o});function s(c){delete e[c]}function i(c){if(c=c||Yt,!ae(e,c))throw Vl.create("no-app",{appName:c});return e[c]}i.App=n;function r(c,h={}){let u=jo(c,h);if(ae(e,u.name))return e[u.name];let d=new n(u,t);return e[u.name]=d,d}function o(){return Object.keys(e).map(c=>e[c])}function a(c){let h=c.name,u=h.replace("-compat","");if(te(c)&&c.type==="PUBLIC"){let d=(p=i())=>{if(typeof p[u]!="function")throw Vl.create("invalid-app-argument",{appName:h});return p[u]()};c.serviceProps!==void 0&&Fn(d,c.serviceProps),t[u]=d,n.prototype[u]=function(...p){return this._getService.bind(this,h).apply(this,c.multipleInstances?p:[])}}return c.type==="PUBLIC"?t[u]:null}function l(c,h){return h==="serverAuth"?null:h}return t}function jl(){let n=Pf(Ni);n.INTERNAL=Object.assign(Object.assign({},n.INTERNAL),{createFirebaseNamespace:jl,extendNamespace:e,createSubscribe:Uo,ErrorFactory:tt,deepExtend:Fn});function e(t){Fn(n,t)}return n}var kf=jl();var Wl=new wt("@firebase/app-compat"),Of="@firebase/app-compat",Df="0.4.2";function Mf(n){M(Of,Df,n)}try{let n=Ro();if(n.firebase!==void 0){Wl.warn(`
      Warning: Firebase is already defined in the global scope. Please make sure
      Firebase library is only loaded once.
    `);let e=n.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&Wl.warn(`
        Warning: You are trying to load Firebase while using Firebase Performance standalone script.
        You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
        `)}}catch{}var cs=kf;Mf();var Ff="firebase",Lf="11.10.0";cs.registerVersion(Ff,Lf,"app-compat");var zl=new Ie("angularfire2.app.options");var wy=typeof module<"u"&&!!module.hot;globalThis.\u0275AngularfireInstanceCache||=[];var cn=(function(n){return n.Unimplemented="UNIMPLEMENTED",n.Unavailable="UNAVAILABLE",n})(cn||{}),ln=class extends Error{constructor(e,t,s){super(e),this.message=e,this.code=t,this.data=s}},xf=n=>{var e,t;return n?.androidBridge?"android":!((t=(e=n?.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},Uf=n=>{let e=n.CapacitorCustomPlatform||null,t=n.Capacitor||{},s=t.Plugins=t.Plugins||{},i=()=>e!==null?e.name:xf(n),r=()=>i()!=="web",o=u=>{let d=c.get(u);return!!(d?.platforms.has(i())||a(u))},a=u=>{var d;return(d=t.PluginHeaders)===null||d===void 0?void 0:d.find(p=>p.name===u)},l=u=>n.console.error(u),c=new Map,h=(u,d={})=>{let p=c.get(u);if(p)return console.warn(`Capacitor plugin "${u}" already registered. Cannot register plugins twice.`),p.proxy;let f=i(),m=a(u),v,P=()=>y(null,null,function*(){return!v&&f in d?v=typeof d[f]=="function"?v=yield d[f]():v=d[f]:e!==null&&!v&&"web"in d&&(v=typeof d.web=="function"?v=yield d.web():v=d.web),v}),D=(S,B)=>{var z,_e;if(m){let G=m?.methods.find(J=>B===J.name);if(G)return G.rtype==="promise"?J=>t.nativePromise(u,B.toString(),J):(J,Qe)=>t.nativeCallback(u,B.toString(),J,Qe);if(S)return(z=S[B])===null||z===void 0?void 0:z.bind(S)}else{if(S)return(_e=S[B])===null||_e===void 0?void 0:_e.bind(S);throw new ln(`"${u}" plugin is not implemented on ${f}`,cn.Unimplemented)}},k=S=>{let B,z=(..._e)=>{let G=P().then(J=>{let Qe=D(J,S);if(Qe){let Xe=Qe(..._e);return B=Xe?.remove,Xe}else throw new ln(`"${u}.${S}()" is not implemented on ${f}`,cn.Unimplemented)});return S==="addListener"&&(G.remove=()=>y(null,null,function*(){return B()})),G};return z.toString=()=>`${S.toString()}() { [capacitor code] }`,Object.defineProperty(z,"name",{value:S,writable:!1,configurable:!1}),z},C=k("addListener"),Z=k("removeListener"),K=(S,B)=>{let z=C({eventName:S},B),_e=()=>y(null,null,function*(){let J=yield z;Z({eventName:S,callbackId:J},B)}),G=new Promise(J=>z.then(()=>J({remove:_e})));return G.remove=()=>y(null,null,function*(){console.warn("Using addListener() without 'await' is deprecated."),yield _e()}),G},$=new Proxy({},{get(S,B){switch(B){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return m?K:C;case"removeListener":return Z;default:return k(B)}}});return s[u]=$,c.set(u,{name:u,proxy:$,platforms:new Set([...Object.keys(d),...m?[f]:[]])}),$};return t.convertFileSrc||(t.convertFileSrc=u=>u),t.getPlatform=i,t.handleError=l,t.isNativePlatform=r,t.isPluginAvailable=o,t.registerPlugin=h,t.Exception=ln,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},Bf=n=>n.Capacitor=Uf(n),un=Bf(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Hl=un.registerPlugin,us=class{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let s=!1;this.listeners[e]||(this.listeners[e]=[],s=!0),this.listeners[e].push(t);let r=this.windowListeners[e];r&&!r.registered&&this.addWindowListener(r),s&&this.sendRetainedArgumentsForEvent(e);let o=()=>y(this,null,function*(){return this.removeListener(e,t)});return Promise.resolve({remove:o})}removeAllListeners(){return y(this,null,function*(){this.listeners={};for(let e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}})}notifyListeners(e,t,s){let i=this.listeners[e];if(!i){if(s){let r=this.retainedEventArguments[e];r||(r=[]),r.push(t),this.retainedEventArguments[e]=r}return}i.forEach(r=>r(t))}hasListeners(e){var t;return!!(!((t=this.listeners[e])===null||t===void 0)&&t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:s=>{this.notifyListeners(t,s)}}}unimplemented(e="not implemented"){return new un.Exception(e,cn.Unimplemented)}unavailable(e="not available"){return new un.Exception(e,cn.Unavailable)}removeListener(e,t){return y(this,null,function*(){let s=this.listeners[e];if(!s)return;let i=s.indexOf(t);this.listeners[e].splice(i,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])})}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){let t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(s=>{this.notifyListeners(e,s)}))}};var Kl=n=>encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Gl=n=>n.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),Pi=class extends us{getCookies(){return y(this,null,function*(){let e=document.cookie,t={};return e.split(";").forEach(s=>{if(s.length<=0)return;let[i,r]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=Gl(i).trim(),r=Gl(r).trim(),t[i]=r}),t})}setCookie(e){return y(this,null,function*(){try{let t=Kl(e.key),s=Kl(e.value),i=`; expires=${(e.expires||"").replace("expires=","")}`,r=(e.path||"/").replace("path=",""),o=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${s||""}${i}; path=${r}; ${o};`}catch(t){return Promise.reject(t)}})}deleteCookie(e){return y(this,null,function*(){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}})}clearCookies(){return y(this,null,function*(){try{let e=document.cookie.split(";")||[];for(let t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}})}clearAllCookies(){return y(this,null,function*(){try{yield this.clearCookies()}catch(e){return Promise.reject(e)}})}},Sy=Hl("CapacitorCookies",{web:()=>new Pi}),$f=n=>y(null,null,function*(){return new Promise((e,t)=>{let s=new FileReader;s.onload=()=>{let i=s.result;e(i.indexOf(",")>=0?i.split(",")[1]:i)},s.onerror=i=>t(i),s.readAsDataURL(n)})}),qf=(n={})=>{let e=Object.keys(n);return Object.keys(n).map(i=>i.toLocaleLowerCase()).reduce((i,r,o)=>(i[r]=n[e[o]],i),{})},Vf=(n,e=!0)=>n?Object.entries(n).reduce((s,i)=>{let[r,o]=i,a,l;return Array.isArray(o)?(l="",o.forEach(c=>{a=e?encodeURIComponent(c):c,l+=`${r}=${a}&`}),l.slice(0,-1)):(a=e?encodeURIComponent(o):o,l=`${r}=${a}`),`${s}&${l}`},"").substr(1):null,Wf=(n,e={})=>{let t=Object.assign({method:n.method||"GET",headers:n.headers},e),i=qf(n.headers)["content-type"]||"";if(typeof n.data=="string")t.body=n.data;else if(i.includes("application/x-www-form-urlencoded")){let r=new URLSearchParams;for(let[o,a]of Object.entries(n.data||{}))r.set(o,a);t.body=r.toString()}else if(i.includes("multipart/form-data")||n.data instanceof FormData){let r=new FormData;if(n.data instanceof FormData)n.data.forEach((a,l)=>{r.append(l,a)});else for(let a of Object.keys(n.data))r.append(a,n.data[a]);t.body=r;let o=new Headers(t.headers);o.delete("content-type"),t.headers=o}else(i.includes("application/json")||typeof n.data=="object")&&(t.body=JSON.stringify(n.data));return t},ki=class extends us{request(e){return y(this,null,function*(){let t=Wf(e,e.webFetchExtra),s=Vf(e.params,e.shouldEncodeUrlParams),i=s?`${e.url}?${s}`:e.url,r=yield fetch(i,t),o=r.headers.get("content-type")||"",{responseType:a="text"}=r.ok?e:{};o.includes("application/json")&&(a="json");let l,c;switch(a){case"arraybuffer":case"blob":c=yield r.blob(),l=yield $f(c);break;case"json":l=yield r.json();break;case"document":case"text":default:l=yield r.text()}let h={};return r.headers.forEach((u,d)=>{h[d]=u}),{data:l,headers:h,status:r.status,url:r.url}})}get(e){return y(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))})}post(e){return y(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))})}put(e){return y(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))})}patch(e){return y(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))})}delete(e){return y(this,null,function*(){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))})}},by=Hl("CapacitorHttp",{web:()=>new ki});var Yl="@firebase/database",Ql="1.0.20";var Nr="";function jf(n){Nr=n}var Bi=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),W(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:xn(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var $i=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return ae(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var Rc=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Bi(e)}}catch{}return new $i},ht=Rc("localStorage"),qi=Rc("sessionStorage");var Mt=new wt("@firebase/database"),zf=(function(){let n=1;return function(){return n++}})(),Nc=function(n){let e=$o(n),t=new xo;t.update(e);let s=t.digest();return Co.encodeByteArray(s)},Sn=function(...n){let e="";for(let t=0;t<n.length;t++){let s=n[t];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=Sn.apply(null,s):typeof s=="object"?e+=W(s):e+=s,e+=" "}return e},dt=null,Xl=!0,Kf=function(n,e){_(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Mt.logLevel=qo.VERBOSE,dt=Mt.log.bind(Mt),e&&qi.set("logging_enabled",!0)):typeof n=="function"?dt=n:(dt=null,qi.remove("logging_enabled"))},Y=function(...n){if(Xl===!0&&(Xl=!1,dt===null&&qi.get("logging_enabled")===!0&&Kf(!0)),dt){let e=Sn.apply(null,n);dt(e)}},bn=function(n){return function(...e){Y(n,...e)}},Vi=function(...n){let e="FIREBASE INTERNAL ERROR: "+Sn(...n);Mt.error(e)},Me=function(...n){let e=`FIREBASE FATAL ERROR: ${Sn(...n)}`;throw Mt.error(e),new Error(e)},ce=function(...n){let e="FIREBASE WARNING: "+Sn(...n);Mt.warn(e)},Gf=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&ce("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Pc=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Hf=function(n){if(Ae()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Lt="[MIN_NAME]",ft="[MAX_NAME]",Wt=function(n,e){if(n===e)return 0;if(n===Lt||e===ft)return-1;if(e===Lt||n===ft)return 1;{let t=Jl(n),s=Jl(e);return t!==null?s!==null?t-s===0?n.length-e.length:t-s:-1:s!==null?1:n<e?-1:1}},Yf=function(n,e){return n===e?0:n<e?-1:1},hn=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+W(e))},Pr=function(n){if(typeof n!="object"||n===null)return W(n);let e=[];for(let s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)s!==0&&(t+=","),t+=W(e[s]),t+=":",t+=Pr(n[e[s]]);return t+="}",t},kc=function(n,e){let t=n.length;if(t<=e)return[n];let s=[];for(let i=0;i<t;i+=e)i+e>t?s.push(n.substring(i,t)):s.push(n.substring(i,i+e));return s};function me(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var Oc=function(n){_(!Pc(n),"Invalid JSON number");let e=11,t=52,s=(1<<e-1)-1,i,r,o,a,l;n===0?(r=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),s),r=a+s,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-s-t))));let c=[];for(l=t;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(i?1:0),c.reverse();let h=c.join(""),u="";for(l=0;l<64;l+=8){let d=parseInt(h.substr(l,8),2).toString(16);d.length===1&&(d="0"+d),u=u+d}return u.toLowerCase()},Qf=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Xf=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};var Jf=new RegExp("^-?(0*)\\d{1,10}$"),Zf=-2147483648,ep=2147483647,Jl=function(n){if(Jf.test(n)){let e=Number(n);if(e>=Zf&&e<=ep)return e}return null},Cn=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw ce("Exception was thrown by user callback.",t),e},Math.floor(0))}},tp=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},_n=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var Wi=class{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Tt(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(s=>this.appCheck=s)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){ce(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}};var ji=class{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Y("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ce(e)}},gn=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),ds="5",Dc="v",Mc="s",Fc="r",Lc="f",xc=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Uc="ls",Bc="p",zi="ac",$c="websocket",qc="long_polling";var fs=class{constructor(e,t,s,i,r=!1,o="",a=!1,l=!1,c=null){this.secure=t,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ht.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ht.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function np(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function Vc(n,e,t){_(typeof e=="string","typeof type must == string"),_(typeof t=="object","typeof params must == object");let s;if(e===$c)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===qc)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);np(n)&&(t.ns=n.namespace);let i=[];return me(t,(r,o)=>{i.push(r+"="+o)}),s+i.join("&")}var Ki=class{constructor(){this.counters_={}}incrementCounter(e,t=1){ae(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Ao(this.counters_)}};var Oi={},Di={};function kr(n){let e=n.toString();return Oi[e]||(Oi[e]=new Ki),Oi[e]}function sp(n,e){let t=n.toString();return Di[t]||(Di[t]=e()),Di[t]}var Gi=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<s.length;++i)s[i]&&Cn(()=>{this.onMessage_(s[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var Zl="start",ip="close",rp="pLPCommand",op="pRTLPCB",Wc="id",jc="pw",zc="ser",ap="cb",lp="seg",cp="ts",up="d",hp="dframe",Kc=1870,Gc=30,dp=Kc-Gc,fp=25e3,pp=3e4,Hi=class n{constructor(e,t,s,i,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=bn(e),this.stats_=kr(t),this.urlFn=l=>(this.appCheckToken&&(l[zi]=this.appCheckToken),Vc(t,qc,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Gi(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(pp)),Hf(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Yi((...r)=>{let[o,a,l,c,h]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Zl)this.id=a,this.password=l;else if(o===ip)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{let[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let s={};s[Zl]="t",s[zc]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[ap]=this.scriptTagHolder.uniqueCallbackIdentifier),s[Dc]=ds,this.transportSessionId&&(s[Mc]=this.transportSessionId),this.lastSessionId&&(s[Uc]=this.lastSessionId),this.applicationId&&(s[Bc]=this.applicationId),this.appCheckToken&&(s[zi]=this.appCheckToken),typeof location<"u"&&location.hostname&&xc.test(location.hostname)&&(s[Fc]=Lc);let i=this.urlFn(s);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return Ae()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Qf()&&!Xf()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=W(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let s=Io(t),i=kc(s,dp);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Ae())return;this.myDisconnFrame=document.createElement("iframe");let s={};s[hp]="t",s[Wc]=e,s[jc]=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=W(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},Yi=class n{constructor(e,t,s,i){if(this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Ae())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=zf(),window[rp+this.uniqueCallbackIdentifier]=e,window[op+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Y("frame writing exception"),a.stack&&Y(a.stack),Y(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Y("No IE domain setting required")}catch{let s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[Wc]=this.myID,e[jc]=this.myPW,e[zc]=this.currentSerial;let t=this.urlFn(e),s="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Gc+s.length<=Kc;){let o=this.pendingSegs.shift();s=s+"&"+lp+i+"="+o.seg+"&"+cp+i+"="+o.ts+"&"+up+i+"="+o.d,i++}return t=t+s,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(s,Math.floor(fp)),r=()=>{clearTimeout(i),s()};this.addTag(e,r)}addTag(e,t){Ae()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){let i=s.readyState;(!i||i==="loaded"||i==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{Y("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}};var mp=16384,_p=45e3,ps=null;typeof MozWebSocket<"u"?ps=MozWebSocket:typeof WebSocket<"u"&&(ps=WebSocket);var dn=(()=>{class n{constructor(t,s,i,r,o,a,l){this.connId=t,this.applicationId=i,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=bn(this.connId),this.stats_=kr(s),this.connURL=n.connectionURL_(s,a,l,r,i),this.nodeAdmin=s.nodeAdmin}static connectionURL_(t,s,i,r,o){let a={};return a[Dc]=ds,!Ae()&&typeof location<"u"&&location.hostname&&xc.test(location.hostname)&&(a[Fc]=Lc),s&&(a[Mc]=s),i&&(a[Uc]=i),r&&(a[zi]=r),o&&(a[Bc]=o),Vc(t,$c,a)}open(t,s){this.onDisconnect=s,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ht.set("previous_websocket_failure",!0);try{let i;if(Ae()){let r=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${ds}/${Nr}/${process.platform}/${r}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new ps(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let r=i.message||i.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let r=i.message||i.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let s=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(s);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&ps!==null&&!n.forceDisallow_}static previouslyFailed(){return ht.isInMemoryStorage||ht.get("previous_websocket_failure")===!0}markConnectionHealthy(){ht.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let s=this.frames.join("");this.frames=null;let i=xn(s);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(_(this.frames===null,"We already have a frame buffer"),t.length<=6){let s=Number(t);if(!isNaN(s))return this.handleNewFrameCount_(s),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let s=t.data;if(this.bytesReceived+=s.length,this.stats_.incrementCounter("bytes_received",s.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(s);else{let i=this.extractFrameCount_(s);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let s=W(t);this.bytesSent+=s.length,this.stats_.incrementCounter("bytes_sent",s.length);let i=kc(s,mp);i.length>1&&this.sendString_(String(i.length));for(let r=0;r<i.length;r++)this.sendString_(i[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(_p))}sendString_(t){try{this.mySock.send(t)}catch(s){this.log_("Exception thrown from WebSocket.send():",s.message||s.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),gp=(()=>{class n{static get ALL_TRANSPORTS(){return[Hi,dn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){let s=dn&&dn.isAvailable(),i=s&&!dn.previouslyFailed();if(t.webSocketOnly&&(s||ce("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[dn];else{let r=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),yp=6e4,vp=5e3,Ep=10*1024,wp=100*1024,Mi="t",ec="d",Tp="s",tc="r",Sp="e",nc="o",sc="a",ic="n",rc="p",bp="h",Qi=class{constructor(e,t,s,i,r,o,a,l,c,h){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=bn("c:"+this.id+":"),this.transportManager_=new gp(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=_n(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>wp?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Ep?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Mi in e){let t=e[Mi];t===sc?this.upgradeIfSecondaryHealthy_():t===tc?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===nc&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=hn("t",e),s=hn("d",e);if(t==="c")this.onSecondaryControl_(s);else if(t==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:rc,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:sc,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:ic,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=hn("t",e),s=hn("d",e);t==="c"?this.onControl_(s):t==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=hn(Mi,e);if(ec in e){let s=e[ec];if(t===bp){let i=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===ic){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Tp?this.onConnectionShutdown_(s):t===tc?this.onReset_(s):t===Sp?Vi("Server Error: "+s):t===nc?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Vi("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,s=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),ds!==s&&ce("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),_n(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(yp))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):_n(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(vp))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:rc,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ht.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var ms=class{put(e,t,s,i){}merge(e,t,s,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}};var _s=class{constructor(e){this.allowedEvents_=e,this.listeners_={},_(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let s=[...this.listeners_[e]];for(let i=0;i<s.length;i++)s[i].callback.apply(s[i].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});let i=this.getInitialEvent(e);i&&t.apply(s,i)}off(e,t,s){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===t&&(!s||s===i[r].context)){i.splice(r,1);return}}validateEventType_(e){_(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var gs=class n extends _s{static getInstance(){return new n}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Ds()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return _(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var oc=32,ac=768,F=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let s=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[s]=this.pieces_[i],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function O(){return new F("")}function I(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Ye(n){return n.pieces_.length-n.pieceNum_}function L(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new F(n.pieces_,e)}function Hc(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Cp(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Yc(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Qc(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new F(e,0)}function j(n,e){let t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof F)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{let s=e.split("/");for(let i=0;i<s.length;i++)s[i].length>0&&t.push(s[i])}return new F(t,0)}function b(n){return n.pieceNum_>=n.pieces_.length}function fe(n,e){let t=I(n),s=I(e);if(t===null)return e;if(t===s)return fe(L(n),L(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Xc(n,e){if(Ye(n)!==Ye(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function Se(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(Ye(n)>Ye(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}var Xi=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Yc(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=Ht(this.parts_[s]);Jc(this)}};function Ip(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ht(e),Jc(n)}function Ap(n){let e=n.parts_.pop();n.byteLength_-=Ht(e),n.parts_.length>0&&(n.byteLength_-=1)}function Jc(n){if(n.byteLength_>ac)throw new Error(n.errorPrefix_+"has a key path longer than "+ac+" bytes ("+n.byteLength_+").");if(n.parts_.length>oc)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+oc+") or object contains a cycle "+ut(n))}function ut(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var Ji=class n extends _s{static getInstance(){return new n}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return _(e==="visible","Unknown event type: "+e),[this.visible_]}};var fn=1e3,Rp=300*1e3,lc=30*1e3,Np=1.3,Pp=3e4,kp="server_kill",cc=3,Or=(()=>{class n extends ms{constructor(t,s,i,r,o,a,l,c){if(super(),this.repoInfo_=t,this.applicationId_=s,this.onDataUpdate_=i,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=bn("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=fn,this.maxReconnectDelay_=Rp,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!Ae())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Ji.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&gs.getInstance().on("online",this.onOnline_,this)}sendRequest(t,s,i){let r=++this.requestNumber_,o={r,a:t,b:s};this.log_(W(o)),_(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[r]=i)}get(t){this.initConnection_();let s=new Os,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?s.resolve(l):s.reject(l)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),s.promise}listen(t,s,i,r){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),_(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),_(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:r,hashFn:s,query:t,tag:i};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(t){let s=this.outstandingGets_[t];this.sendRequest("g",s.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),s.onComplete&&s.onComplete(i)})}sendListen_(t){let s=t.query,i=s._path.toString(),r=s._queryIdentifier;this.log_("Listen on "+i+" for "+r);let o={p:i},a="q";t.tag&&(o.q=s._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,l=>{let c=l.d,h=l.s;n.warnOnListenWarnings_(c,s),(this.listens.get(i)&&this.listens.get(i).get(r))===t&&(this.log_("listen response",l),h!=="ok"&&this.removeListen_(i,r),t.onComplete&&t.onComplete(h,c))})}static warnOnListenWarnings_(t,s){if(t&&typeof t=="object"&&ae(t,"w")){let i=nt(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let r='".indexOn": "'+s._queryParams.getIndex().toString()+'"',o=s._path.toString();ce(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||Fo(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=lc)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,s=Mo(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(s,i,r=>{let o=r.s,a=r.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let s=t.s,i=t.d||"error";s==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(s,i)})}unlisten(t,s){let i=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+r),_(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,r)&&this.connected_&&this.sendUnlisten_(i,r,t._queryObject,s)}sendUnlisten_(t,s,i,r){this.log_("Unlisten on "+t+" for "+s);let o={p:t},a="n";r&&(o.q=i,o.t=r),this.sendRequest(a,o)}onDisconnectPut(t,s,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,s,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:s,onComplete:i})}onDisconnectMerge(t,s,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,s,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:s,onComplete:i})}onDisconnectCancel(t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:s})}sendOnDisconnect_(t,s,i,r){let o={p:s,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(t,s,i,r){this.putInternal("p",t,s,i,r)}merge(t,s,i,r){this.putInternal("m",t,s,i,r)}putInternal(t,s,i,r,o){this.initConnection_();let a={p:s,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:r}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+s)}sendPut_(t){let s=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(s,i,o=>{this.log_(s+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(t){if(this.connected_){let s={c:t};this.log_("reportStats",s),this.sendRequest("s",s,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+W(t));let s=t.r,i=this.requestCBHash_[s];i&&(delete this.requestCBHash_[s],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,s){this.log_("handleServerMessage",t,s),t==="d"?this.onDataUpdate_(s.p,s.d,!1,s.t):t==="m"?this.onDataUpdate_(s.p,s.d,!0,s.t):t==="c"?this.onListenRevoked_(s.p,s.q):t==="ac"?this.onAuthRevoked_(s.s,s.d):t==="apc"?this.onAppCheckRevoked_(s.s,s.d):t==="sd"?this.onSecurityDebugPacket_(s):Vi("Unrecognized action received from server: "+W(t)+`
Are you using the latest client?`)}onReady_(t,s){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=s,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){_(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=fn,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=fn,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Pp&&(this.reconnectDelay_=fn),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),s=Math.max(0,this.reconnectDelay_-t);s=Math.random()*s,this.log_("Trying to reconnect in "+s+"ms"),this.scheduleConnect_(s),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Np)}this.onConnectStatus_(!1)}establishConnection_(){return y(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),s=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,i())},h=function(d){_(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(d)};this.realtime_={close:c,sendRequest:h};let u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[d,p]=yield Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);a?Y("getToken() completed but was canceled"):(Y("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=p&&p.token,l=new Qi(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,s,i,f=>{ce(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(kp)},o))}catch(d){this.log_("Failed to get token: "+d),a||(this.repoInfo_.nodeAdmin&&ce(d),c())}}})}interrupt(t){Y("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Y("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Ms(this.interruptReasons_)&&(this.reconnectDelay_=fn,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let s=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:s})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let s=this.outstandingPuts_[t];s&&"h"in s.request&&s.queued&&(s.onComplete&&s.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,s){let i;s?i=s.map(o=>Pr(o)).join("$"):i="default";let r=this.removeListen_(t,i);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,s){let i=new F(t).toString(),r;if(this.listens.has(i)){let o=this.listens.get(i);r=o.get(s),o.delete(s),o.size===0&&this.listens.delete(i)}else r=void 0;return r}onAuthRevoked_(t,s){Y("Auth token revoked: "+t+"/"+s),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=cc&&(this.reconnectDelay_=lc,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,s){Y("App check token revoked: "+t+"/"+s),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=cc&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let s of t.values())this.sendListen_(s);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},s="js";Ae()&&(this.repoInfo_.nodeAdmin?s="admin_node":s="node"),t["sdk."+s+"."+Nr.replace(/\./g,"-")]=1,Ds()?t["framework.cordova"]=1:Po()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=gs.getInstance().currentlyOnline();return Ms(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),A=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var xt=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let s=new A(Lt,e),i=new A(Lt,t);return this.compare(s,i)!==0}minPost(){return A.MIN}};var hs,ys=class extends xt{static get __EMPTY_NODE(){return hs}static set __EMPTY_NODE(e){hs=e}compare(e,t){return Wt(e.name,t.name)}isDefinedOn(e){throw gt("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return A.MIN}maxPost(){return new A(ft,hs)}makePost(e,t){return _(typeof e=="string","KeyIndex indexValue must always be a string."),new A(e,hs)}toString(){return".key"}},Ft=new ys;var Ot=class{constructor(e,t,s,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?s(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Te=(()=>{class n{constructor(t,s,i,r,o){this.key=t,this.value=s,this.color=i??n.RED,this.left=r??pe.EMPTY_NODE,this.right=o??pe.EMPTY_NODE}copy(t,s,i,r,o){return new n(t??this.key,s??this.value,i??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,s,i){let r=this,o=i(t,r.key);return o<0?r=r.copy(null,null,null,r.left.insert(t,s,i),null):o===0?r=r.copy(null,s,null,null,null):r=r.copy(null,null,null,null,r.right.insert(t,s,i)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return pe.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,s){let i,r;if(i=this,s(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,s),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),s(t,i.key)===0){if(i.right.isEmpty())return pe.EMPTY_NODE;r=i.right.min_(),i=i.copy(r.key,r.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,s))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,s)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),Zi=class{copy(e,t,s,i,r){return this}insert(e,t,s){return new Te(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},pe=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Te.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Te.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),t===0)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,i=null;for(;!s.isEmpty();)if(t=this.comparator_(e,s.key),t===0){if(s.left.isEmpty())return i?i.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else t<0?s=s.left:t>0&&(i=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ot(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ot(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ot(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ot(this.root_,null,this.comparator_,!0,e)}};pe.EMPTY_NODE=new Zi;function Op(n,e){return Wt(n.name,e.name)}function Dr(n,e){return Wt(n,e)}var er;function Dp(n){er=n}var Zc=function(n){return typeof n=="number"?"number:"+Oc(n):"string:"+n},eu=function(n){if(n.isLeafNode()){let e=n.val();_(typeof e=="string"||typeof e=="number"||typeof e=="object"&&ae(e,".sv"),"Priority must be a string or number.")}else _(n===er||n.isEmpty(),"priority of unexpected type.");_(n===er||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var uc,Ut=(()=>{class n{static set __childrenNodeConstructor(t){uc=t}static get __childrenNodeConstructor(){return uc}constructor(t,s=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=s,this.lazyHash_=null,_(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),eu(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return b(t)?this:I(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,s){return null}updateImmediateChild(t,s){return t===".priority"?this.updatePriority(s):s.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,s).updatePriority(this.priorityNode_)}updateChild(t,s){let i=I(t);return i===null?s:s.isEmpty()&&i!==".priority"?this:(_(i!==".priority"||Ye(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(L(t),s)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,s){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Zc(this.priorityNode_.val())+":");let s=typeof this.value_;t+=s+":",s==="number"?t+=Oc(this.value_):t+=this.value_,this.lazyHash_=Nc(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(_(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let s=typeof t.value_,i=typeof this.value_,r=n.VALUE_TYPE_ORDER.indexOf(s),o=n.VALUE_TYPE_ORDER.indexOf(i);return _(r>=0,"Unknown leaf type: "+s),_(o>=0,"Unknown leaf type: "+i),r===o?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let s=t;return this.value_===s.value_&&this.priorityNode_.equals(s.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),tu,nu;function Mp(n){tu=n}function Fp(n){nu=n}var tr=class extends xt{compare(e,t){let s=e.node.getPriority(),i=t.node.getPriority(),r=s.compareTo(i);return r===0?Wt(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return A.MIN}maxPost(){return new A(ft,new Ut("[PRIORITY-POST]",nu))}makePost(e,t){let s=tu(e);return new A(t,new Ut("[PRIORITY-POST]",s))}toString(){return".priority"}},X=new tr;var Lp=Math.log(2),nr=class{constructor(e){let t=r=>parseInt(Math.log(r)/Lp,10),s=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=s(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},vs=function(n,e,t,s){n.sort(e);let i=function(l,c){let h=c-l,u,d;if(h===0)return null;if(h===1)return u=n[l],d=t?t(u):u,new Te(d,u.node,Te.BLACK,null,null);{let p=parseInt(h/2,10)+l,f=i(l,p),m=i(p+1,c);return u=n[p],d=t?t(u):u,new Te(d,u.node,Te.BLACK,f,m)}},r=function(l){let c=null,h=null,u=n.length,d=function(f,m){let v=u-f,P=u;u-=f;let D=i(v+1,P),k=n[v],C=t?t(k):k;p(new Te(C,k.node,m,null,D))},p=function(f){c?(c.left=f,c=f):(h=f,c=f)};for(let f=0;f<l.count;++f){let m=l.nextBitIsOne(),v=Math.pow(2,l.count-(f+1));m?d(v,Te.BLACK):(d(v,Te.BLACK),d(v,Te.RED))}return h},o=new nr(n.length),a=r(o);return new pe(s||e,a)};var Fi,kt={},Bt=class n{static get Default(){return _(kt&&X,"ChildrenNode.ts has not been loaded"),Fi=Fi||new n({".priority":kt},{".priority":X}),Fi}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=nt(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof pe?t:null}hasIndex(e){return ae(this.indexSet_,e.toString())}addIndex(e,t){_(e!==Ft,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let s=[],i=!1,r=t.getIterator(A.Wrap),o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),s.push(o),o=r.getNext();let a;i?a=vs(s,e.getCompare()):a=kt;let l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;let h=Object.assign({},this.indexes_);return h[l]=a,new n(h,c)}addToIndexes(e,t){let s=Gt(this.indexes_,(i,r)=>{let o=nt(this.indexSet_,r);if(_(o,"Missing index implementation for "+r),i===kt)if(o.isDefinedOn(e.node)){let a=[],l=t.getIterator(A.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),vs(a,o.getCompare())}else return kt;else{let a=t.get(e.name),l=i;return a&&(l=l.remove(new A(e.name,a))),l.insert(e,e.node)}});return new n(s,this.indexSet_)}removeFromIndexes(e,t){let s=Gt(this.indexes_,i=>{if(i===kt)return i;{let r=t.get(e.name);return r?i.remove(new A(e.name,r)):i}});return new n(s,this.indexSet_)}};var pn,U=(()=>{class n{static get EMPTY_NODE(){return pn||(pn=new n(new pe(Dr),null,Bt.Default))}constructor(t,s,i){this.children_=t,this.priorityNode_=s,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&eu(this.priorityNode_),this.children_.isEmpty()&&_(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||pn}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let s=this.children_.get(t);return s===null?pn:s}}getChild(t){let s=I(t);return s===null?this:this.getImmediateChild(s).getChild(L(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,s){if(_(s,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(s);{let i=new A(t,s),r,o;s.isEmpty()?(r=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(r=this.children_.insert(t,s),o=this.indexMap_.addToIndexes(i,this.children_));let a=r.isEmpty()?pn:this.priorityNode_;return new n(r,a,o)}}updateChild(t,s){let i=I(t);if(i===null)return s;{_(I(t)!==".priority"||Ye(t)===1,".priority must be the last token in a path");let r=this.getImmediateChild(i).updateChild(L(t),s);return this.updateImmediateChild(i,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let s={},i=0,r=0,o=!0;if(this.forEachChild(X,(a,l)=>{s[a]=l.val(t),i++,o&&n.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!t&&o&&r<2*i){let a=[];for(let l in s)a[l]=s[l];return a}else return t&&!this.getPriority().isEmpty()&&(s[".priority"]=this.getPriority().val()),s}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+Zc(this.getPriority().val())+":"),this.forEachChild(X,(s,i)=>{let r=i.hash();r!==""&&(t+=":"+s+":"+r)}),this.lazyHash_=t===""?"":Nc(t)}return this.lazyHash_}getPredecessorChildName(t,s,i){let r=this.resolveIndex_(i);if(r){let o=r.getPredecessorKey(new A(t,s));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let s=this.resolveIndex_(t);if(s){let i=s.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let s=this.getFirstChildName(t);return s?new A(s,this.children_.get(s)):null}getLastChildName(t){let s=this.resolveIndex_(t);if(s){let i=s.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let s=this.getLastChildName(t);return s?new A(s,this.children_.get(s)):null}forEachChild(t,s){let i=this.resolveIndex_(t);return i?i.inorderTraversal(r=>s(r.name,r.node)):this.children_.inorderTraversal(s)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,s){let i=this.resolveIndex_(s);if(i)return i.getIteratorFrom(t,r=>r);{let r=this.children_.getIteratorFrom(t.name,A.Wrap),o=r.peek();for(;o!=null&&s.compare(o,t)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,s){let i=this.resolveIndex_(s);if(i)return i.getReverseIteratorFrom(t,r=>r);{let r=this.children_.getReverseIteratorFrom(t.name,A.Wrap),o=r.peek();for(;o!=null&&s.compare(o,t)>0;)r.getNext(),o=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===In?-1:0}withIndex(t){if(t===Ft||this.indexMap_.hasIndex(t))return this;{let s=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,s)}}isIndexed(t){return t===Ft||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let s=t;if(this.getPriority().equals(s.getPriority()))if(this.children_.count()===s.children_.count()){let i=this.getIterator(X),r=s.getIterator(X),o=i.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=r.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===Ft?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),sr=class extends U{constructor(){super(new pe(Dr),U.EMPTY_NODE,Bt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return U.EMPTY_NODE}isEmpty(){return!1}},In=new sr;Object.defineProperties(A,{MIN:{value:new A(Lt,U.EMPTY_NODE)},MAX:{value:new A(ft,In)}});ys.__EMPTY_NODE=U.EMPTY_NODE;Ut.__childrenNodeConstructor=U;Dp(In);Fp(In);var xp=!0;function Q(n,e=null){if(n===null)return U.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),_(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new Ut(t,Q(e))}if(!(n instanceof Array)&&xp){let t=[],s=!1;if(me(n,(o,a)=>{if(o.substring(0,1)!=="."){let l=Q(a);l.isEmpty()||(s=s||!l.getPriority().isEmpty(),t.push(new A(o,l)))}}),t.length===0)return U.EMPTY_NODE;let r=vs(t,Op,o=>o.name,Dr);if(s){let o=vs(t,X.getCompare());return new U(r,Q(e),new Bt({".priority":o},{".priority":X}))}else return new U(r,Q(e),Bt.Default)}else{let t=U.EMPTY_NODE;return me(n,(s,i)=>{if(ae(n,s)&&s.substring(0,1)!=="."){let r=Q(i);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(s,r))}}),t.updatePriority(Q(e))}}Mp(Q);var ir=class extends xt{constructor(e){super(),this.indexPath_=e,_(!b(e)&&I(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let s=this.extractChild(e.node),i=this.extractChild(t.node),r=s.compareTo(i);return r===0?Wt(e.name,t.name):r}makePost(e,t){let s=Q(e),i=U.EMPTY_NODE.updateChild(this.indexPath_,s);return new A(t,i)}maxPost(){let e=U.EMPTY_NODE.updateChild(this.indexPath_,In);return new A(ft,e)}toString(){return Yc(this.indexPath_,0).join("/")}};var rr=class extends xt{compare(e,t){let s=e.node.compareTo(t.node);return s===0?Wt(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return A.MIN}maxPost(){return A.MAX}makePost(e,t){let s=Q(e);return new A(t,s)}toString(){return".value"}},Up=new rr;function Bp(n){return{type:"value",snapshotNode:n}}function $p(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function qp(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function hc(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Vp(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var or=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=X}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return _(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return _(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Lt}hasEnd(){return this.endSet_}getIndexEndValue(){return _(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return _(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ft}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return _(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===X}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function dc(n){let e={};if(n.isDefault())return e;let t;if(n.index_===X?t="$priority":n.index_===Up?t="$value":n.index_===Ft?t="$key":(_(n.index_ instanceof ir,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=W(t),n.startSet_){let s=n.startAfterSet_?"startAfter":"startAt";e[s]=W(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+W(n.indexStartName_))}if(n.endSet_){let s=n.endBeforeSet_?"endBefore":"endAt";e[s]=W(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+W(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function fc(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==X&&(e.i=n.index_.toString()),e}var ar=class n extends ms{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(_(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,s,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=bn("p:rest:"),this.listens_={}}listen(e,t,s,i){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let o=n.getListenId_(e,s),a={};this.listens_[o]=a;let l=dc(e._queryParams);this.restRequest_(r+".json",l,(c,h)=>{let u=h;if(c===404&&(u=null,c=null),c===null&&this.onDataUpdate_(r,u,!1,s),nt(this.listens_,o)===a){let d;c?c===401?d="permission_denied":d="rest_error:"+c:d="ok",i(d,null)}})}unlisten(e,t){let s=n.getListenId_(e,t);delete this.listens_[s]}get(e){let t=dc(e._queryParams),s=e._path.toString(),i=new Os;return this.restRequest_(s+".json",t,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(s,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Lo(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=xn(a.responseText)}catch{ce("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,l)}else a.status!==401&&a.status!==404&&ce("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}};var lr=class{constructor(){this.rootNode_=U.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Es(){return{value:null,children:new Map}}function su(n,e,t){if(b(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let s=I(e);n.children.has(s)||n.children.set(s,Es());let i=n.children.get(s);e=L(e),su(i,e,t)}}function cr(n,e,t){n.value!==null?t(e,n.value):Wp(n,(s,i)=>{let r=new F(e.toString()+"/"+s);cr(i,r,t)})}function Wp(n,e){n.children.forEach((t,s)=>{e(s,t)})}var ur=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&me(this.last_,(s,i)=>{t[s]=t[s]-i}),this.last_=e,t}};var pc=10*1e3,jp=30*1e3,zp=300*1e3,hr=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new ur(e);let s=pc+(jp-pc)*Math.random();_n(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){let e=this.statsListener_.get(),t={},s=!1;me(e,(i,r)=>{r>0&&ae(this.statsToReport_,i)&&(t[i]=r,s=!0)}),s&&this.server_.reportStats(t),_n(this.reportStats_.bind(this),Math.floor(Math.random()*2*zp))}};var De=(function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n})(De||{});function iu(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function ru(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function ou(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var dr=class n{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=De.ACK_USER_WRITE,this.source=iu()}operationForChild(e){if(b(this.path)){if(this.affectedTree.value!=null)return _(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new F(e));return new n(O(),t,this.revert)}}else return _(I(this.path)===e,"operationForChild called for unrelated child."),new n(L(this.path),this.affectedTree,this.revert)}};var $t=class n{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=De.OVERWRITE}operationForChild(e){return b(this.path)?new n(this.source,O(),this.snap.getImmediateChild(e)):new n(this.source,L(this.path),this.snap)}};var ws=class n{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=De.MERGE}operationForChild(e){if(b(this.path)){let t=this.children.subtree(new F(e));return t.isEmpty()?null:t.value?new $t(this.source,O(),t.value):new n(this.source,O(),t)}else return _(I(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,L(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var En=class{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(b(e))return this.isFullyInitialized()&&!this.filtered_;let t=I(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};function Kp(n,e,t,s){let i=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(Vp(o.childName,o.snapshotNode))}),mn(n,i,"child_removed",e,s,t),mn(n,i,"child_added",e,s,t),mn(n,i,"child_moved",r,s,t),mn(n,i,"child_changed",e,s,t),mn(n,i,"value",e,s,t),i}function mn(n,e,t,s,i,r){let o=s.filter(a=>a.type===t);o.sort((a,l)=>Hp(n,a,l)),o.forEach(a=>{let l=Gp(n,a,r);i.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function Gp(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Hp(n,e,t){if(e.childName==null||t.childName==null)throw gt("Should only compare child_ events.");let s=new A(e.childName,e.snapshotNode),i=new A(t.childName,t.snapshotNode);return n.index_.compare(s,i)}function au(n,e){return{eventCache:n,serverCache:e}}function yn(n,e,t,s){return au(new En(e,t,s),n.serverCache)}function lu(n,e,t,s){return au(n.eventCache,new En(e,t,s))}function fr(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function pt(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var Li,Yp=()=>(Li||(Li=new pe(Yf)),Li),re=class n{static fromObject(e){let t=new n(null);return me(e,(s,i)=>{t=t.set(new F(s),i)}),t}constructor(e,t=Yp()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:O(),value:this.value};if(b(e))return null;{let s=I(e),i=this.children.get(s);if(i!==null){let r=i.findRootMostMatchingPathAndValue(L(e),t);return r!=null?{path:j(new F(s),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(b(e))return this;{let t=I(e),s=this.children.get(t);return s!==null?s.subtree(L(e)):new n(null)}}set(e,t){if(b(e))return new n(t,this.children);{let s=I(e),r=(this.children.get(s)||new n(null)).set(L(e),t),o=this.children.insert(s,r);return new n(this.value,o)}}remove(e){if(b(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=I(e),s=this.children.get(t);if(s){let i=s.remove(L(e)),r;return i.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,i),this.value===null&&r.isEmpty()?new n(null):new n(this.value,r)}else return this}}get(e){if(b(e))return this.value;{let t=I(e),s=this.children.get(t);return s?s.get(L(e)):null}}setTree(e,t){if(b(e))return t;{let s=I(e),r=(this.children.get(s)||new n(null)).setTree(L(e),t),o;return r.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,r),new n(this.value,o)}}fold(e){return this.fold_(O(),e)}fold_(e,t){let s={};return this.children.inorderTraversal((i,r)=>{s[i]=r.fold_(j(e,i),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,O(),t)}findOnPath_(e,t,s){let i=this.value?s(t,this.value):!1;if(i)return i;if(b(e))return null;{let r=I(e),o=this.children.get(r);return o?o.findOnPath_(L(e),j(t,r),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,O(),t)}foreachOnPath_(e,t,s){if(b(e))return this;{this.value&&s(t,this.value);let i=I(e),r=this.children.get(i);return r?r.foreachOnPath_(L(e),j(t,i),s):new n(null)}}foreach(e){this.foreach_(O(),e)}foreach_(e,t){this.children.inorderTraversal((s,i)=>{i.foreach_(j(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}};var be=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new re(null))}};function vn(n,e,t){if(b(e))return new be(new re(t));{let s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){let i=s.path,r=s.value,o=fe(i,e);return r=r.updateChild(o,t),new be(n.writeTree_.set(i,r))}else{let i=new re(t),r=n.writeTree_.setTree(e,i);return new be(r)}}}function mc(n,e,t){let s=n;return me(t,(i,r)=>{s=vn(s,j(e,i),r)}),s}function _c(n,e){if(b(e))return be.empty();{let t=n.writeTree_.setTree(e,new re(null));return new be(t)}}function pr(n,e){return mt(n,e)!=null}function mt(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(fe(t.path,e)):null}function gc(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(X,(s,i)=>{e.push(new A(s,i))}):n.writeTree_.children.inorderTraversal((s,i)=>{i.value!=null&&e.push(new A(s,i.value))}),e}function He(n,e){if(b(e))return n;{let t=mt(n,e);return t!=null?new be(new re(t)):new be(n.writeTree_.subtree(e))}}function mr(n){return n.writeTree_.isEmpty()}function qt(n,e){return cu(O(),n.writeTree_,e)}function cu(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(_(r.value!==null,"Priority writes must always be leaf nodes"),s=r.value):t=cu(j(n,i),r,t)}),!t.getChild(n).isEmpty()&&s!==null&&(t=t.updateChild(j(n,".priority"),s)),t}}function uu(n,e){return mu(e,n)}function Qp(n,e,t,s,i){_(s>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:i}),i&&(n.visibleWrites=vn(n.visibleWrites,e,t)),n.lastWriteId=s}function Xp(n,e){for(let t=0;t<n.allWrites.length;t++){let s=n.allWrites[t];if(s.writeId===e)return s}return null}function Jp(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);_(t>=0,"removeWrite called with nonexistent writeId.");let s=n.allWrites[t];n.allWrites.splice(t,1);let i=s.visible,r=!1,o=n.allWrites.length-1;for(;i&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&Zp(a,s.path)?i=!1:Se(s.path,a.path)&&(r=!0)),o--}if(i){if(r)return em(n),!0;if(s.snap)n.visibleWrites=_c(n.visibleWrites,s.path);else{let a=s.children;me(a,l=>{n.visibleWrites=_c(n.visibleWrites,j(s.path,l))})}return!0}else return!1}function Zp(n,e){if(n.snap)return Se(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&Se(j(n.path,t),e))return!0;return!1}function em(n){n.visibleWrites=hu(n.allWrites,tm,O()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function tm(n){return n.visible}function hu(n,e,t){let s=be.empty();for(let i=0;i<n.length;++i){let r=n[i];if(e(r)){let o=r.path,a;if(r.snap)Se(t,o)?(a=fe(t,o),s=vn(s,a,r.snap)):Se(o,t)&&(a=fe(o,t),s=vn(s,O(),r.snap.getChild(a)));else if(r.children){if(Se(t,o))a=fe(t,o),s=mc(s,a,r.children);else if(Se(o,t))if(a=fe(o,t),b(a))s=mc(s,O(),r.children);else{let l=nt(r.children,I(a));if(l){let c=l.getChild(L(a));s=vn(s,O(),c)}}}else throw gt("WriteRecord should have .snap or .children")}}return s}function du(n,e,t,s,i){if(!s&&!i){let r=mt(n.visibleWrites,e);if(r!=null)return r;{let o=He(n.visibleWrites,e);if(mr(o))return t;if(t==null&&!pr(o,O()))return null;{let a=t||U.EMPTY_NODE;return qt(o,a)}}}else{let r=He(n.visibleWrites,e);if(!i&&mr(r))return t;if(!i&&t==null&&!pr(r,O()))return null;{let o=function(c){return(c.visible||i)&&(!s||!~s.indexOf(c.writeId))&&(Se(c.path,e)||Se(e,c.path))},a=hu(n.allWrites,o,e),l=t||U.EMPTY_NODE;return qt(a,l)}}}function nm(n,e,t){let s=U.EMPTY_NODE,i=mt(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(X,(r,o)=>{s=s.updateImmediateChild(r,o)}),s;if(t){let r=He(n.visibleWrites,e);return t.forEachChild(X,(o,a)=>{let l=qt(He(r,new F(o)),a);s=s.updateImmediateChild(o,l)}),gc(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{let r=He(n.visibleWrites,e);return gc(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function sm(n,e,t,s,i){_(s||i,"Either existingEventSnap or existingServerSnap must exist");let r=j(e,t);if(pr(n.visibleWrites,r))return null;{let o=He(n.visibleWrites,r);return mr(o)?i.getChild(t):qt(o,i.getChild(t))}}function im(n,e,t,s){let i=j(e,t),r=mt(n.visibleWrites,i);if(r!=null)return r;if(s.isCompleteForChild(t)){let o=He(n.visibleWrites,i);return qt(o,s.getNode().getImmediateChild(t))}else return null}function rm(n,e){return mt(n.visibleWrites,e)}function om(n,e,t,s,i,r,o){let a,l=He(n.visibleWrites,e),c=mt(l,O());if(c!=null)a=c;else if(t!=null)a=qt(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let h=[],u=o.getCompare(),d=r?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o),p=d.getNext();for(;p&&h.length<i;)u(p,s)!==0&&h.push(p),p=d.getNext();return h}else return[]}function am(){return{visibleWrites:be.empty(),allWrites:[],lastWriteId:-1}}function _r(n,e,t,s){return du(n.writeTree,n.treePath,e,t,s)}function fu(n,e){return nm(n.writeTree,n.treePath,e)}function yc(n,e,t,s){return sm(n.writeTree,n.treePath,e,t,s)}function Ts(n,e){return rm(n.writeTree,j(n.treePath,e))}function lm(n,e,t,s,i,r){return om(n.writeTree,n.treePath,e,t,s,i,r)}function Mr(n,e,t){return im(n.writeTree,n.treePath,e,t)}function pu(n,e){return mu(j(n.treePath,e),n.writeTree)}function mu(n,e){return{treePath:n,writeTree:e}}var gr=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,s=e.childName;_(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),_(s!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(s);if(i){let r=i.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(s,hc(s,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(s);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(s,qp(s,i.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(s,$p(s,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(s,hc(s,e.snapshotNode,i.oldSnap));else throw gt("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}};var yr=class{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}},_u=new yr,wn=class{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let s=this.optCompleteServerCache_!=null?new En(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Mr(this.writes_,e,s)}}getChildAfterChild(e,t,s){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:pt(this.viewCache_),r=lm(this.writes_,i,t,1,s,e);return r.length===0?null:r[0]}};function cm(n,e){_(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),_(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function um(n,e,t,s,i){let r=new gr,o,a;if(t.type===De.OVERWRITE){let c=t;c.source.fromUser?o=vr(n,e,c.path,c.snap,s,i,r):(_(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!b(c.path),o=Ss(n,e,c.path,c.snap,s,i,a,r))}else if(t.type===De.MERGE){let c=t;c.source.fromUser?o=dm(n,e,c.path,c.children,s,i,r):(_(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=Er(n,e,c.path,c.children,s,i,a,r))}else if(t.type===De.ACK_USER_WRITE){let c=t;c.revert?o=mm(n,e,c.path,s,i,r):o=fm(n,e,c.path,c.affectedTree,s,i,r)}else if(t.type===De.LISTEN_COMPLETE)o=pm(n,e,t.path,s,r);else throw gt("Unknown operation type: "+t.type);let l=r.getChanges();return hm(e,o,l),{viewCache:o,changes:l}}function hm(n,e,t){let s=e.eventCache;if(s.isFullyInitialized()){let i=s.getNode().isLeafNode()||s.getNode().isEmpty(),r=fr(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!s.getNode().equals(r)||!s.getNode().getPriority().equals(r.getPriority()))&&t.push(Bp(fr(e)))}}function gu(n,e,t,s,i,r){let o=e.eventCache;if(Ts(s,t)!=null)return e;{let a,l;if(b(t))if(_(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=pt(e),h=c instanceof U?c:U.EMPTY_NODE,u=fu(s,h);a=n.filter.updateFullNode(e.eventCache.getNode(),u,r)}else{let c=_r(s,pt(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{let c=I(t);if(c===".priority"){_(Ye(t)===1,"Can't have a priority with additional path components");let h=o.getNode();l=e.serverCache.getNode();let u=yc(s,t,h,l);u!=null?a=n.filter.updatePriority(h,u):a=o.getNode()}else{let h=L(t),u;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();let d=yc(s,t,o.getNode(),l);d!=null?u=o.getNode().getImmediateChild(c).updateChild(h,d):u=o.getNode().getImmediateChild(c)}else u=Mr(s,c,e.serverCache);u!=null?a=n.filter.updateChild(o.getNode(),c,u,h,i,r):a=o.getNode()}}return yn(e,a,o.isFullyInitialized()||b(t),n.filter.filtersNodes())}}function Ss(n,e,t,s,i,r,o,a){let l=e.serverCache,c,h=o?n.filter:n.filter.getIndexedFilter();if(b(t))c=h.updateFullNode(l.getNode(),s,null);else if(h.filtersNodes()&&!l.isFiltered()){let p=l.getNode().updateChild(t,s);c=h.updateFullNode(l.getNode(),p,null)}else{let p=I(t);if(!l.isCompleteForPath(t)&&Ye(t)>1)return e;let f=L(t),v=l.getNode().getImmediateChild(p).updateChild(f,s);p===".priority"?c=h.updatePriority(l.getNode(),v):c=h.updateChild(l.getNode(),p,v,f,_u,null)}let u=lu(e,c,l.isFullyInitialized()||b(t),h.filtersNodes()),d=new wn(i,u,r);return gu(n,u,t,i,d,a)}function vr(n,e,t,s,i,r,o){let a=e.eventCache,l,c,h=new wn(i,e,r);if(b(t))c=n.filter.updateFullNode(e.eventCache.getNode(),s,o),l=yn(e,c,!0,n.filter.filtersNodes());else{let u=I(t);if(u===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),s),l=yn(e,c,a.isFullyInitialized(),a.isFiltered());else{let d=L(t),p=a.getNode().getImmediateChild(u),f;if(b(d))f=s;else{let m=h.getCompleteChild(u);m!=null?Hc(d)===".priority"&&m.getChild(Qc(d)).isEmpty()?f=m:f=m.updateChild(d,s):f=U.EMPTY_NODE}if(p.equals(f))l=e;else{let m=n.filter.updateChild(a.getNode(),u,f,d,h,o);l=yn(e,m,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function vc(n,e){return n.eventCache.isCompleteForChild(e)}function dm(n,e,t,s,i,r,o){let a=e;return s.foreach((l,c)=>{let h=j(t,l);vc(e,I(h))&&(a=vr(n,a,h,c,i,r,o))}),s.foreach((l,c)=>{let h=j(t,l);vc(e,I(h))||(a=vr(n,a,h,c,i,r,o))}),a}function Ec(n,e,t){return t.foreach((s,i)=>{e=e.updateChild(s,i)}),e}function Er(n,e,t,s,i,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;b(t)?c=s:c=new re(null).setTree(t,s);let h=e.serverCache.getNode();return c.children.inorderTraversal((u,d)=>{if(h.hasChild(u)){let p=e.serverCache.getNode().getImmediateChild(u),f=Ec(n,p,d);l=Ss(n,l,new F(u),f,i,r,o,a)}}),c.children.inorderTraversal((u,d)=>{let p=!e.serverCache.isCompleteForChild(u)&&d.value===null;if(!h.hasChild(u)&&!p){let f=e.serverCache.getNode().getImmediateChild(u),m=Ec(n,f,d);l=Ss(n,l,new F(u),m,i,r,o,a)}}),l}function fm(n,e,t,s,i,r,o){if(Ts(i,t)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(s.value!=null){if(b(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return Ss(n,e,t,l.getNode().getChild(t),i,r,a,o);if(b(t)){let c=new re(null);return l.getNode().forEachChild(Ft,(h,u)=>{c=c.set(new F(h),u)}),Er(n,e,t,c,i,r,a,o)}else return e}else{let c=new re(null);return s.foreach((h,u)=>{let d=j(t,h);l.isCompleteForPath(d)&&(c=c.set(h,l.getNode().getChild(d)))}),Er(n,e,t,c,i,r,a,o)}}function pm(n,e,t,s,i){let r=e.serverCache,o=lu(e,r.getNode(),r.isFullyInitialized()||b(t),r.isFiltered());return gu(n,o,t,s,_u,i)}function mm(n,e,t,s,i,r){let o;if(Ts(s,t)!=null)return e;{let a=new wn(s,e,i),l=e.eventCache.getNode(),c;if(b(t)||I(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=_r(s,pt(e));else{let u=e.serverCache.getNode();_(u instanceof U,"serverChildren would be complete if leaf node"),h=fu(s,u)}h=h,c=n.filter.updateFullNode(l,h,r)}else{let h=I(t),u=Mr(s,h,e.serverCache);u==null&&e.serverCache.isCompleteForChild(h)&&(u=l.getImmediateChild(h)),u!=null?c=n.filter.updateChild(l,h,u,L(t),a,r):e.eventCache.getNode().hasChild(h)?c=n.filter.updateChild(l,h,U.EMPTY_NODE,L(t),a,r):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=_r(s,pt(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||Ts(s,O())!=null,yn(e,c,o,n.filter.filtersNodes())}}function _m(n,e){let t=pt(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!b(e)&&!t.getImmediateChild(I(e)).isEmpty())?t.getChild(e):null}function wc(n,e,t,s){e.type===De.MERGE&&e.source.queryId!==null&&(_(pt(n.viewCache_),"We should always have a full cache before handling merges"),_(fr(n.viewCache_),"Missing event cache, even though we have a server cache"));let i=n.viewCache_,r=um(n.processor_,i,e,t,s);return cm(n.processor_,r.viewCache),_(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,gm(n,r.changes,r.viewCache.eventCache.getNode(),null)}function gm(n,e,t,s){let i=s?[s]:n.eventRegistrations_;return Kp(n.eventGenerator_,e,t,i)}var Tc;function ym(n){_(!Tc,"__referenceConstructor has already been defined"),Tc=n}function Fr(n,e,t,s){let i=e.source.queryId;if(i!==null){let r=n.views.get(i);return _(r!=null,"SyncTree gave us an op for an invalid query."),wc(r,e,t,s)}else{let r=[];for(let o of n.views.values())r=r.concat(wc(o,e,t,s));return r}}function Lr(n,e){let t=null;for(let s of n.views.values())t=t||_m(s,e);return t}var Sc;function vm(n){_(!Sc,"__referenceConstructor has already been defined"),Sc=n}var bs=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new re(null),this.pendingWriteTree_=am(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Em(n,e,t,s,i){return Qp(n.pendingWriteTree_,e,t,s,i),i?Is(n,new $t(iu(),e,t)):[]}function Dt(n,e,t=!1){let s=Xp(n.pendingWriteTree_,e);if(Jp(n.pendingWriteTree_,e)){let r=new re(null);return s.snap!=null?r=r.set(O(),!0):me(s.children,o=>{r=r.set(new F(o),!0)}),Is(n,new dr(s.path,r,t))}else return[]}function Cs(n,e,t){return Is(n,new $t(ru(),e,t))}function wm(n,e,t){let s=re.fromObject(t);return Is(n,new ws(ru(),e,s))}function Tm(n,e,t,s){let i=wu(n,s);if(i!=null){let r=Tu(i),o=r.path,a=r.queryId,l=fe(o,e),c=new $t(ou(a),l,t);return Su(n,o,c)}else return[]}function Sm(n,e,t,s){let i=wu(n,s);if(i){let r=Tu(i),o=r.path,a=r.queryId,l=fe(o,e),c=re.fromObject(t),h=new ws(ou(a),l,c);return Su(n,o,h)}else return[]}function yu(n,e,t){let i=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{let l=fe(o,e),c=Lr(a,l);if(c)return c});return du(i,e,r,t,!0)}function Is(n,e){return vu(e,n.syncPointTree_,null,uu(n.pendingWriteTree_,O()))}function vu(n,e,t,s){if(b(n.path))return Eu(n,e,t,s);{let i=e.get(O());t==null&&i!=null&&(t=Lr(i,O()));let r=[],o=I(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){let c=t?t.getImmediateChild(o):null,h=pu(s,o);r=r.concat(vu(a,l,c,h))}return i&&(r=r.concat(Fr(i,n,s,t))),r}}function Eu(n,e,t,s){let i=e.get(O());t==null&&i!=null&&(t=Lr(i,O()));let r=[];return e.children.inorderTraversal((o,a)=>{let l=t?t.getImmediateChild(o):null,c=pu(s,o),h=n.operationForChild(o);h&&(r=r.concat(Eu(h,a,l,c)))}),i&&(r=r.concat(Fr(i,n,s,t))),r}function wu(n,e){return n.tagToQueryMap.get(e)}function Tu(n){let e=n.indexOf("$");return _(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new F(n.substr(0,e))}}function Su(n,e,t){let s=n.syncPointTree_.get(e);_(s,"Missing sync point for query tag that we're tracking");let i=uu(n.pendingWriteTree_,e);return Fr(s,t,i,null)}var wr=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},Tr=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=j(this.path_,e);return new n(this.syncTree_,t)}node(){return yu(this.syncTree_,this.path_)}},bm=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},bc=function(n,e,t){if(!n||typeof n!="object")return n;if(_(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return Cm(n[".sv"],e,t);if(typeof n[".sv"]=="object")return Im(n[".sv"],e);_(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},Cm=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:_(!1,"Unexpected server value: "+n)}},Im=function(n,e,t){n.hasOwnProperty("increment")||_(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let s=n.increment;typeof s!="number"&&_(!1,"Unexpected increment value: "+s);let i=e.node();if(_(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return s;let o=i.getValue();return typeof o!="number"?s:o+s},Am=function(n,e,t,s){return xr(e,new Tr(t,n),s)},Rm=function(n,e,t){return xr(n,new wr(e),t)};function xr(n,e,t){let s=n.getPriority().val(),i=bc(s,e.getImmediateChild(".priority"),t),r;if(n.isLeafNode()){let o=n,a=bc(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new Ut(a,Q(i)):n}else{let o=n;return r=o,i!==o.getPriority().val()&&(r=r.updatePriority(new Ut(i))),o.forEachChild(X,(a,l)=>{let c=xr(l,e.getImmediateChild(a),t);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}var Tn=class{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}};function Ur(n,e){let t=e instanceof F?e:new F(e),s=n,i=I(t);for(;i!==null;){let r=nt(s.node.children,i)||{children:{},childCount:0};s=new Tn(i,s,r),t=L(t),i=I(t)}return s}function jt(n){return n.node.value}function bu(n,e){n.node.value=e,Sr(n)}function Cu(n){return n.node.childCount>0}function Nm(n){return jt(n)===void 0&&!Cu(n)}function As(n,e){me(n.node.children,(t,s)=>{e(new Tn(t,n,s))})}function Iu(n,e,t,s){t&&!s&&e(n),As(n,i=>{Iu(i,e,!0,s)}),t&&s&&e(n)}function Pm(n,e,t){let s=t?n:n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function An(n){return new F(n.parent===null?n.name:An(n.parent)+"/"+n.name)}function Sr(n){n.parent!==null&&km(n.parent,n.name,n)}function km(n,e,t){let s=Nm(t),i=ae(n.node.children,e);s&&i?(delete n.node.children[e],n.node.childCount--,Sr(n)):!s&&!i&&(n.node.children[e]=t.node,n.node.childCount++,Sr(n))}var Om=/[\[\].#$\/\u0000-\u001F\u007F]/,Dm=/[\[\].#$\u0000-\u001F\u007F]/,xi=10*1024*1024,Au=function(n){return typeof n=="string"&&n.length!==0&&!Om.test(n)},Mm=function(n){return typeof n=="string"&&n.length!==0&&!Dm.test(n)},Fm=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Mm(n)};var Ru=function(n,e,t){let s=t instanceof F?new Xi(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+ut(s));if(typeof e=="function")throw new Error(n+"contains a function "+ut(s)+" with contents = "+e.toString());if(Pc(e))throw new Error(n+"contains "+e.toString()+" "+ut(s));if(typeof e=="string"&&e.length>xi/3&&Ht(e)>xi)throw new Error(n+"contains a string greater than "+xi+" utf8 bytes "+ut(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(me(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Au(o)))throw new Error(n+" contains an invalid key ("+o+") "+ut(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Ip(s,o),Ru(n,a,s),Ap(s)}),i&&r)throw new Error(n+' contains ".value" child '+ut(s)+" in addition to actual children.")}};var Lm=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Au(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Fm(t))throw new Error(Bo(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var br=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function xm(n,e){let t=null;for(let s=0;s<e.length;s++){let i=e[s],r=i.getPath();t!==null&&!Xc(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(i)}t&&n.eventLists_.push(t)}function _t(n,e,t){xm(n,t),Um(n,s=>Se(s,e)||Se(e,s))}function Um(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){let i=n.eventLists_[s];if(i){let r=i.path;e(r)?(Bm(n.eventLists_[s]),n.eventLists_[s]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function Bm(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let s=t.getEventRunner();dt&&Y("event: "+t.toString()),Cn(s)}}}var $m="repo_interrupt",qm=25,Cr=class{constructor(e,t,s,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new br,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Es(),this.transactionQueueTree_=new Tn,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function Vm(n,e,t){if(n.stats_=kr(n.repoInfo_),n.forceRestClient_||tp())n.server_=new ar(n.repoInfo_,(s,i,r,o)=>{Cc(n,s,i,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Ic(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{W(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new Or(n.repoInfo_,e,(s,i,r,o)=>{Cc(n,s,i,r,o)},s=>{Ic(n,s)},s=>{jm(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=sp(n.repoInfo_,()=>new hr(n.stats_,n.server_)),n.infoData_=new lr,n.infoSyncTree_=new bs({startListening:(s,i,r,o)=>{let a=[],l=n.infoData_.getNode(s._path);return l.isEmpty()||(a=Cs(n.infoSyncTree_,s._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Br(n,"connected",!1),n.serverSyncTree_=new bs({startListening:(s,i,r,o)=>(n.server_.listen(s,r,i,(a,l)=>{let c=o(a,l);_t(n.eventQueue_,s._path,c)}),[]),stopListening:(s,i)=>{n.server_.unlisten(s,i)}})}function Wm(n){let t=n.infoData_.getNode(new F(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Nu(n){return bm({timestamp:Wm(n)})}function Cc(n,e,t,s,i){n.dataUpdateCount++;let r=new F(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(s){let l=Gt(t,c=>Q(c));o=Sm(n.serverSyncTree_,r,l,i)}else{let l=Q(t);o=Tm(n.serverSyncTree_,r,l,i)}else if(s){let l=Gt(t,c=>Q(c));o=wm(n.serverSyncTree_,r,l)}else{let l=Q(t);o=Cs(n.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=qr(n,r)),_t(n.eventQueue_,a,o)}function Ic(n,e){Br(n,"connected",e),e===!1&&Km(n)}function jm(n,e){me(e,(t,s)=>{Br(n,t,s)})}function Br(n,e,t){let s=new F("/.info/"+e),i=Q(t);n.infoData_.updateSnapshot(s,i);let r=Cs(n.infoSyncTree_,s,i);_t(n.eventQueue_,s,r)}function zm(n){return n.nextWriteId_++}function Km(n){Pu(n,"onDisconnectEvents");let e=Nu(n),t=Es();cr(n.onDisconnect_,O(),(i,r)=>{let o=Am(i,r,n.serverSyncTree_,e);su(t,i,o)});let s=[];cr(t,O(),(i,r)=>{s=s.concat(Cs(n.serverSyncTree_,i,r));let o=Qm(n,i);qr(n,o)}),n.onDisconnect_=Es(),_t(n.eventQueue_,O(),s)}function Gm(n){n.persistentConnection_&&n.persistentConnection_.interrupt($m)}function Pu(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Y(t,...e)}function ku(n,e,t){return yu(n.serverSyncTree_,e,t)||U.EMPTY_NODE}function $r(n,e=n.transactionQueueTree_){if(e||Rs(n,e),jt(e)){let t=Du(n,e);_(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&Hm(n,An(e),t)}else Cu(e)&&As(e,t=>{$r(n,t)})}function Hm(n,e,t){let s=t.map(c=>c.currentWriteId),i=ku(n,e,s),r=i,o=i.hash();for(let c=0;c<t.length;c++){let h=t[c];_(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;let u=fe(e,h.path);r=r.updateChild(u,h.currentOutputSnapshotRaw)}let a=r.val(!0),l=e;n.server_.put(l.toString(),a,c=>{Pu(n,"transaction put response",{path:l.toString(),status:c});let h=[];if(c==="ok"){let u=[];for(let d=0;d<t.length;d++)t[d].status=2,h=h.concat(Dt(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&u.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();Rs(n,Ur(n.transactionQueueTree_,e)),$r(n,n.transactionQueueTree_),_t(n.eventQueue_,e,h);for(let d=0;d<u.length;d++)Cn(u[d])}else{if(c==="datastale")for(let u=0;u<t.length;u++)t[u].status===3?t[u].status=4:t[u].status=0;else{ce("transaction at "+l.toString()+" failed: "+c);for(let u=0;u<t.length;u++)t[u].status=4,t[u].abortReason=c}qr(n,e)}},o)}function qr(n,e){let t=Ou(n,e),s=An(t),i=Du(n,t);return Ym(n,i,s),s}function Ym(n,e,t){if(e.length===0)return;let s=[],i=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=fe(t,l.path),h=!1,u;if(_(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,u=l.abortReason,i=i.concat(Dt(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=qm)h=!0,u="maxretry",i=i.concat(Dt(n.serverSyncTree_,l.currentWriteId,!0));else{let d=ku(n,l.path,o);l.currentInputSnapshot=d;let p=e[a].update(d.val());if(p!==void 0){Ru("transaction failed: Data returned ",p,l.path);let f=Q(p);typeof p=="object"&&p!=null&&ae(p,".priority")||(f=f.updatePriority(d.getPriority()));let v=l.currentWriteId,P=Nu(n),D=Rm(f,d,P);l.currentOutputSnapshotRaw=f,l.currentOutputSnapshotResolved=D,l.currentWriteId=zm(n),o.splice(o.indexOf(v),1),i=i.concat(Em(n.serverSyncTree_,l.path,D,l.currentWriteId,l.applyLocally)),i=i.concat(Dt(n.serverSyncTree_,v,!0))}else h=!0,u="nodata",i=i.concat(Dt(n.serverSyncTree_,l.currentWriteId,!0))}_t(n.eventQueue_,t,i),i=[],h&&(e[a].status=2,(function(d){setTimeout(d,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(u==="nodata"?s.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):s.push(()=>e[a].onComplete(new Error(u),!1,null))))}Rs(n,n.transactionQueueTree_);for(let a=0;a<s.length;a++)Cn(s[a]);$r(n,n.transactionQueueTree_)}function Ou(n,e){let t,s=n.transactionQueueTree_;for(t=I(e);t!==null&&jt(s)===void 0;)s=Ur(s,t),e=L(e),t=I(e);return s}function Du(n,e){let t=[];return Mu(n,e,t),t.sort((s,i)=>s.order-i.order),t}function Mu(n,e,t){let s=jt(e);if(s)for(let i=0;i<s.length;i++)t.push(s[i]);As(e,i=>{Mu(n,i,t)})}function Rs(n,e){let t=jt(e);if(t){let s=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[s]=t[i],s++);t.length=s,bu(e,t.length>0?t:void 0)}As(e,s=>{Rs(n,s)})}function Qm(n,e){let t=An(Ou(n,e)),s=Ur(n.transactionQueueTree_,e);return Pm(s,i=>{Ui(n,i)}),Ui(n,s),Iu(s,i=>{Ui(n,i)}),t}function Ui(n,e){let t=jt(e);if(t){let s=[],i=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(_(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(_(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(Dt(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&s.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?bu(e,void 0):t.length=r+1,_t(n.eventQueue_,An(e),i);for(let o=0;o<s.length;o++)Cn(s[o])}}function Xm(n){let e="",t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let i=t[s];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function Jm(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let s=t.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):ce(`Invalid query segment '${t}' in query '${n}'`)}return e}var Ac=function(n,e){let t=Zm(n),s=t.namespace;t.domain==="firebase.com"&&Me(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&t.domain!=="localhost"&&Me("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Gf();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new fs(t.host,t.secure,s,i,e,"",s!==t.subdomain),path:new F(t.pathString)}},Zm=function(n){let e="",t="",s="",i="",r="",o=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let h=n.indexOf("/");h===-1&&(h=n.length);let u=n.indexOf("?");u===-1&&(u=n.length),e=n.substring(0,Math.min(h,u)),h<u&&(i=Xm(n.substring(h,u)));let d=Jm(n.substring(Math.min(n.length,u)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let p=e.slice(0,c);if(p.toLowerCase()==="localhost")t="localhost";else if(p.split(".").length<=2)t=p;else{let f=e.indexOf(".");s=e.substring(0,f).toLowerCase(),t=e.substring(f+1),r=s}"ns"in d&&(r=d.ns)}return{host:e,port:l,domain:t,subdomain:s,secure:o,scheme:a,pathString:i,namespace:r}};var Ir=class n{constructor(e,t,s,i){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=i}get key(){return b(this._path)?null:Hc(this._path)}get ref(){return new Vt(this._repo,this._path)}get _queryIdentifier(){let e=fc(this._queryParams),t=Pr(e);return t==="{}"?"default":t}get _queryObject(){return fc(this._queryParams)}isEqual(e){if(e=ye(e),!(e instanceof n))return!1;let t=this._repo===e._repo,s=Xc(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+Cp(this._path)}};var Vt=class n extends Ir{constructor(e,t){super(e,t,new or,!1)}get parent(){let e=Qc(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}};ym(Vt);vm(Vt);var e_="FIREBASE_DATABASE_EMULATOR_HOST",Ar={},t_=!1;function n_(n,e,t,s){let i=e.lastIndexOf(":"),r=e.substring(0,i),o=Ze(r);n.repoInfo_=new fs(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),s&&(n.authTokenProvider_=s)}function s_(n,e,t,s,i){let r=s||n.options.databaseURL;r===void 0&&(n.options.projectId||Me("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Y("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Ac(r,i),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[e_]),c?(l=!0,r=`http://${c}?ns=${a.namespace}`,o=Ac(r,i),a=o.repoInfo):l=!o.repoInfo.secure;let h=i&&l?new gn(gn.OWNER):new ji(n.name,n.options,e);Lm("Invalid Firebase Database URL",o),b(o.path)||Me("Database URL must point to the root of a Firebase Database (not including a child path).");let u=r_(a,n,h,new Wi(n,t));return new Rr(u,n)}function i_(n,e){let t=Ar[e];(!t||t[n.key]!==n)&&Me(`Database ${e}(${n.repoInfo_}) has already been deleted.`),Gm(n),delete t[n.key]}function r_(n,e,t,s){let i=Ar[e.name];i||(i={},Ar[e.name]=i);let r=i[n.toURLString()];return r&&Me("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Cr(n,t_,t,s),i[n.toURLString()]=r,r}var Rr=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Vm(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Vt(this._repo,O())),this._rootInternal}_delete(){return this._rootInternal!==null&&(i_(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Me("Cannot call "+e+" on a deleted database.")}};function Fu(n=Pe(),e){let t=he(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){let s=yt("database");s&&Lu(t,...s)}return t}function Lu(n,e,t,s={}){n=ye(n),n._checkNotDeleted("useEmulator");let i=`${e}:${t}`,r=n._repoInternal;if(n._instanceStarted){if(i===n._repoInternal.repoInfo_.host&&Un(s,r.repoInfo_.emulatorOptions))return;Me("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)s.mockUserToken&&Me('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new gn(gn.OWNER);else if(s.mockUserToken){let a=typeof s.mockUserToken=="string"?s.mockUserToken:Ln(s.mockUserToken,n.app.options.projectId);o=new gn(a)}Ze(e)&&(vt(e),Et("Database",!0)),n_(r,i,s,o)}function o_(n){jf(St),te(new ee("database",(e,{instanceIdentifier:t})=>{let s=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return s_(s,i,r,t)},"PUBLIC").setMultipleInstances(!0)),M(Yl,Ql,n),M(Yl,Ql,"esm2017")}Or.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Or.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};o_();var Rn=class{constructor(e){return e}},xu="database",Vr=class{constructor(){return Ve(xu)}};var Wr=new Ie("angularfire2.database-instances");function a_(n,e){let t=qe(xu,n,e);return t&&new Rn(t)}function l_(n){return(e,t)=>{let s=e.runOutsideAngular(()=>n(t));return new Rn(s)}}var c_={provide:Vr,deps:[[new q,Wr]]},u_={provide:Rn,useFactory:a_,deps:[[new q,Wr],ze]};function Uu(n,...e){return M("angularfire",$e.full,"rtdb"),Ue([u_,c_,{provide:Wr,useFactory:l_(n),multi:!0,deps:[ge,Be,We,Ke,[new q,Ct],[new q,bt],...e]}])}var Bu=je(Fu,!0);var zu="firebasestorage.googleapis.com",h_="storageBucket",d_=120*1e3,f_=600*1e3;var Ne=class n extends et{constructor(e,t,s=0){super(jr(e),`Firebase Storage: ${t} (${jr(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,n.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return jr(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},Le=(function(n){return n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment",n})(Le||{});function jr(n){return"storage/"+n}function p_(){let n="An unknown error occurred, please check the error payload for server response.";return new Ne(Le.UNKNOWN,n)}function m_(){return new Ne(Le.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function __(){return new Ne(Le.CANCELED,"User canceled the upload/download.")}function g_(n){return new Ne(Le.INVALID_URL,"Invalid URL '"+n+"'.")}function y_(n){return new Ne(Le.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function $u(n){return new Ne(Le.INVALID_ARGUMENT,n)}function Ku(){return new Ne(Le.APP_DELETED,"The Firebase app was deleted.")}function v_(n){return new Ne(Le.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}var Fe=class n{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let s;try{s=n.makeFromUrl(e,t)}catch{return new n(e,"")}if(s.path==="")return s;throw y_(e)}static makeFromUrl(e,t){let s=null,i="([A-Za-z0-9.\\-_]+)";function r(C){C.path.charAt(C.path.length-1)==="/"&&(C.path_=C.path_.slice(0,-1))}let o="(/(.*))?$",a=new RegExp("^gs://"+i+o,"i"),l={bucket:1,path:3};function c(C){C.path_=decodeURIComponent(C.path)}let h="v[A-Za-z0-9_]+",u=t.replace(/[.]/g,"\\."),d="(/([^?#]*).*)?$",p=new RegExp(`^https?://${u}/${h}/b/${i}/o${d}`,"i"),f={bucket:1,path:3},m=t===zu?"(?:storage.googleapis.com|storage.cloud.google.com)":t,v="([^?#]*)",P=new RegExp(`^https?://${m}/${i}/${v}`,"i"),k=[{regex:a,indices:l,postModify:r},{regex:p,indices:f,postModify:c},{regex:P,indices:{bucket:1,path:2},postModify:c}];for(let C=0;C<k.length;C++){let Z=k[C],K=Z.regex.exec(e);if(K){let $=K[Z.indices.bucket],S=K[Z.indices.path];S||(S=""),s=new n($,S),Z.postModify(s);break}}if(s==null)throw g_(e);return s}},zr=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};function E_(n,e,t){let s=1,i=null,r=null,o=!1,a=0;function l(){return a===2}let c=!1;function h(...v){c||(c=!0,e.apply(null,v))}function u(v){i=setTimeout(()=>{i=null,n(p,l())},v)}function d(){r&&clearTimeout(r)}function p(v,...P){if(c){d();return}if(v){d(),h.call(null,v,...P);return}if(l()||o){d(),h.call(null,v,...P);return}s<64&&(s*=2);let k;a===1?(a=2,k=0):k=(s+Math.random())*1e3,u(k)}let f=!1;function m(v){f||(f=!0,d(),!c&&(i!==null?(v||(a=2),clearTimeout(i),u(0)):v||(a=1)))}return u(0),r=setTimeout(()=>{o=!0,m(!0)},t),m}function w_(n){n(!1)}function T_(n){return n!==void 0}function qu(n,e,t,s){if(s<e)throw $u(`Invalid value for '${n}'. Expected ${e} or greater.`);if(s>t)throw $u(`Invalid value for '${n}'. Expected ${t} or less.`)}function S_(n){let e=encodeURIComponent,t="?";for(let s in n)if(n.hasOwnProperty(s)){let i=e(s)+"="+e(n[s]);t=t+i+"&"}return t=t.slice(0,-1),t}var Kr=(function(n){return n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT",n})(Kr||{});function b_(n,e){let t=n>=500&&n<600,i=[408,429].indexOf(n)!==-1,r=e.indexOf(n)!==-1;return t||i||r}var Gr=class{constructor(e,t,s,i,r,o,a,l,c,h,u,d=!0,p=!1){this.url_=e,this.method_=t,this.headers_=s,this.body_=i,this.successCodes_=r,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=h,this.connectionFactory_=u,this.retry=d,this.isUsingEmulator=p,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((f,m)=>{this.resolve_=f,this.reject_=m,this.start_()})}start_(){let e=(s,i)=>{if(i){s(!1,new zt(!1,null,!0));return}let r=this.connectionFactory_();this.pendingConnection_=r;let o=a=>{let l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&r.addUploadProgressListener(o),r.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&r.removeUploadProgressListener(o),this.pendingConnection_=null;let a=r.getErrorCode()===Kr.NO_ERROR,l=r.getStatus();if(!a||b_(l,this.additionalRetryCodes_)&&this.retry){let h=r.getErrorCode()===Kr.ABORT;s(!1,new zt(!1,null,h));return}let c=this.successCodes_.indexOf(l)!==-1;s(!0,new zt(c,r))})},t=(s,i)=>{let r=this.resolve_,o=this.reject_,a=i.connection;if(i.wasSuccessCode)try{let l=this.callback_(a,a.getResponse());T_(l)?r(l):r()}catch(l){o(l)}else if(a!==null){let l=p_();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(i.canceled){let l=this.appDelete_?Ku():__();o(l)}else{let l=m_();o(l)}};this.canceled_?t(!1,new zt(!1,null,!0)):this.backoffId_=E_(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&w_(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},zt=class{constructor(e,t,s){this.wasSuccessCode=e,this.connection=t,this.canceled=!!s}};function C_(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function I_(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function A_(n,e){e&&(n["X-Firebase-GMPID"]=e)}function R_(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function N_(n,e,t,s,i,r,o=!0,a=!1){let l=S_(n.urlParams),c=n.url+l,h=Object.assign({},n.headers);return A_(h,e),C_(h,t),I_(h,r),R_(h,s),new Gr(c,n.method,h,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,i,o,a)}function P_(n){if(n.length===0)return null;let e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function k_(n){let e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}var Ov=256*1024;var Hr=class n{constructor(e,t){this._service=e,t instanceof Fe?this._location=t:this._location=Fe.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new n(e,t)}get root(){let e=new Fe(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return k_(this._location.path)}get storage(){return this._service}get parent(){let e=P_(this._location.path);if(e===null)return null;let t=new Fe(this._location.bucket,e);return new n(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw v_(e)}};function Vu(n,e){let t=e?.[h_];return t==null?null:Fe.makeFromBucketSpec(t,n)}function O_(n,e,t,s={}){n.host=`${e}:${t}`;let i=Ze(e);i&&(vt(`https://${n.host}/b`),Et("Storage",!0)),n._isUsingEmulator=!0,n._protocol=i?"https":"http";let{mockUserToken:r}=s;r&&(n._overrideAuthToken=typeof r=="string"?r:Ln(r,n.app.options.projectId))}var Yr=class{constructor(e,t,s,i,r,o=!1){this.app=e,this._authProvider=t,this._appCheckProvider=s,this._url=i,this._firebaseVersion=r,this._isUsingEmulator=o,this._bucket=null,this._host=zu,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=d_,this._maxUploadRetryTime=f_,this._requests=new Set,i!=null?this._bucket=Fe.makeFromBucketSpec(i,this._host):this._bucket=Vu(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Fe.makeFromBucketSpec(this._url,e):this._bucket=Vu(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){qu("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){qu("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return y(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=yield e.getToken();if(t!==null)return t.accessToken}return null})}_getAppCheckToken(){return y(this,null,function*(){if(Tt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Hr(this,e)}_makeRequest(e,t,s,i,r=!0){if(this._deleted)return new zr(Ku());{let o=N_(e,this._appId,s,i,t,this._firebaseVersion,r,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,t){return y(this,null,function*(){let[s,i]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,s,i).getPromise()})}},Wu="@firebase/storage",ju="0.13.14";var Gu="storage";function Hu(n=Pe(),e){n=ye(n);let s=he(n,Gu).getImmediate({identifier:e}),i=yt("storage");return i&&Yu(s,...i),s}function Yu(n,e,t,s={}){O_(n,e,t,s)}function D_(n,{instanceIdentifier:e}){let t=n.getProvider("app").getImmediate(),s=n.getProvider("auth-internal"),i=n.getProvider("app-check-internal");return new Yr(t,s,i,e,St)}function M_(){te(new ee(Gu,D_,"PUBLIC").setMultipleInstances(!0)),M(Wu,ju,""),M(Wu,ju,"esm2017")}M_();var Nn=class{constructor(e){return e}},Qu="storage",Qr=class{constructor(){return Ve(Qu)}};var Xr=new Ie("angularfire2.storage-instances");function F_(n,e){let t=qe(Qu,n,e);return t&&new Nn(t)}function L_(n){return(e,t)=>{let s=e.runOutsideAngular(()=>n(t));return new Nn(s)}}var x_={provide:Qr,deps:[[new q,Xr]]},U_={provide:Nn,useFactory:F_,deps:[[new q,Xr],ze]};function Xu(n,...e){return M("angularfire",$e.full,"gcs"),Ue([U_,x_,{provide:Xr,useFactory:L_(n),multi:!0,deps:[ge,Be,We,Ke,[new q,Ct],[new q,bt],...e]}])}var Ju=je(Hu,!0);var th="functions";var Jr=class{constructor(e,t,s,i){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,Tt(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=s.getImmediate({optional:!0}),this.auth||t.get().then(r=>this.auth=r,()=>{}),this.messaging||s.get().then(r=>this.messaging=r,()=>{}),this.appCheck||i?.get().then(r=>this.appCheck=r,()=>{})}getAuthToken(){return y(this,null,function*(){if(this.auth)try{let e=yield this.auth.getToken();return e?.accessToken}catch{return}})}getMessagingToken(){return y(this,null,function*(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return yield this.messaging.getToken()}catch{return}})}getAppCheckToken(e){return y(this,null,function*(){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){let t=e?yield this.appCheck.getLimitedUseToken():yield this.appCheck.getToken();return t.error?null:t.token}return null})}getContext(e){return y(this,null,function*(){let t=yield this.getAuthToken(),s=yield this.getMessagingToken(),i=yield this.getAppCheckToken(e);return{authToken:t,messagingToken:s,appCheckToken:i}})}};var Zr="us-central1";var eo=class{constructor(e,t,s,i,r=Zr,o=(...a)=>fetch(...a)){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new Jr(e,t,s,i),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{let a=new URL(r);this.customDomain=a.origin+(a.pathname==="/"?"":a.pathname),this.region=Zr}catch{this.customDomain=null,this.region=r}}_delete(){return this.deleteService()}_url(e){let t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}};function B_(n,e,t){let s=Ze(e);n.emulatorOrigin=`http${s?"s":""}://${e}:${t}`,s&&(vt(n.emulatorOrigin),Et("Functions",!0))}var Zu="@firebase/functions",eh="0.12.9";var $_="auth-internal",q_="app-check-internal",V_="messaging-internal";function W_(n){let e=(t,{instanceIdentifier:s})=>{let i=t.getProvider("app").getImmediate(),r=t.getProvider($_),o=t.getProvider(V_),a=t.getProvider(q_);return new eo(i,r,o,a,s)};te(new ee(th,e,"PUBLIC").setMultipleInstances(!0)),M(Zu,eh,n),M(Zu,eh,"esm2017")}function nh(n=Pe(),e=Zr){let s=he(ye(n),th).getImmediate({identifier:e}),i=yt("functions");return i&&sh(s,...i),s}function sh(n,e,t){B_(ye(n),e,t)}W_();var Pn=class{constructor(e){return e}},ih="functions",to=class{constructor(){return Ve(ih)}};var no=new Ie("angularfire2.functions-instances");function j_(n,e){let t=qe(ih,n,e);return t&&new Pn(t)}function z_(n){return(e,t)=>{let s=e.runOutsideAngular(()=>n(t));return new Pn(s)}}var K_={provide:to,deps:[[new q,no]]},G_={provide:Pn,useFactory:j_,deps:[[new q,no],ze]};function rh(n,...e){return M("angularfire",$e.full,"fn"),Ue([G_,K_,{provide:no,useFactory:z_(n),multi:!0,deps:[ge,Be,We,Ke,[new q,Ct],[new q,bt],...e]}])}var oh=je(nh,!0);mo(rl,{providers:[{provide:go,useClass:wo},{provide:zl,useValue:rn.firebaseConfig},bo({mode:"ios"}),vo(il,Eo(yo)),Yo(()=>Xo(rn.firebaseConfig)),na(()=>sa()),Uu(()=>Bu()),Xu(()=>Ju()),ql(()=>$l()),sl(),rh(()=>oh(void 0,"us-west1")),Zo(()=>un.isNativePlatform()?ta(Qo(),{persistence:Jo}):ea()),_o()]});
