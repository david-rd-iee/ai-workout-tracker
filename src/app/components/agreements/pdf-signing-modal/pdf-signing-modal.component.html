<ion-header>
  <ion-toolbar>
    <ion-title>Agreement Document</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="dismiss()">Close</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div *ngIf="loading" class="ion-text-center">
    <ion-spinner></ion-spinner>
    <p>Loading PDF...</p>
  </div>

  <div *ngIf="error && !loading" class="ion-text-center error-message">
    <p>{{ error }}</p>
  </div>
  
  <!-- Mobile-optimized PDF viewer -->
  <div *ngIf="pdfUrl && !loading && !error" class="pdf-container">
    <iframe
      [src]="pdfViewerUrl"
      class="pdf-viewer"
      frameborder="0"
      allow="fullscreen">
    </iframe>
  </div>

  <!-- Show client signature section -->
  <div class="signing-container" *ngIf="pdfUrl && !loading && !error && signerType === 'client'">
    <!-- Show signature if client has already signed -->
    <div *ngIf="isSignedByClient" class="signed-message">
      <ion-card>
        <ion-card-header>
          <ion-card-title>Document Signed</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p>You have signed this document with the name: <strong>{{ fullName }}</strong></p>
        </ion-card-content>
      </ion-card>
    </div>
    
    <!-- Show signing form if client hasn't signed yet -->
    <form *ngIf="!isSignedByClient" #signForm="ngForm" (ngSubmit)="signDocument(signForm)">
      <ion-item>
        <ion-input
          id="fullName"
          type="text"
          name="fullName"
          [(ngModel)]="fullName"
          required
          minlength="2"
          label="Full Name"
          labelPlacement="floating"
          helperText="Please sign with your full name">
        </ion-input>
      </ion-item>

      <div class="ion-padding-top">
        <ion-button expand="block" type="submit" [disabled]="!signForm.valid || loading">
          {{ loading ? 'Signing...' : 'Sign Document' }}
        </ion-button>
      </div>
    </form>
  </div>
</ion-content>
