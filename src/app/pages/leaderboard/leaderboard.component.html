<ion-header>
  <ion-toolbar>
    <ion-title>Leaderboard</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="background-gradient"></div>
  <ion-card>
    <ion-card-header>
      <ion-card-title>Sort Options</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <!-- Region sort -->
      <ion-item>
        <ion-label>Region</ion-label>
        <ion-select
          [(ngModel)]="regionSort"
          (ionChange)="onRegionSortChange($event)"
          interface="popover"
          placeholder="No region filter">
          <ion-select-option value="none">None</ion-select-option>
          <ion-select-option value="city">City</ion-select-option>
          <ion-select-option value="state">State</ion-select-option>
          <ion-select-option value="country">Country</ion-select-option>
        </ion-select>
      </ion-item>

      <!-- Workout type (metric) sort -->
      <ion-item class="ion-margin-top">
        <ion-label>Workout Type</ion-label>
        <ion-select
          [(ngModel)]="metricSort"
          (ionChange)="onMetricSortChange($event)"
          interface="popover"
          placeholder="Select type">
          <ion-select-option value="total">Total (All Work)</ion-select-option>
          <ion-select-option value="cardio">Cardio</ion-select-option>
          <ion-select-option value="strength">Strength</ion-select-option>
        </ion-select>
      </ion-item>
    </ion-card-content>
  </ion-card>

  <!-- Pull to refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="loadLeaderboard(); $event.target.complete()">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Loading -->
  <div class="ion-text-center ion-padding" *ngIf="loading">
    <ion-spinner name="crescent"></ion-spinner>
  </div>

  <!-- Error -->
  <ion-text color="danger" class="ion-padding" *ngIf="!loading && errorMessage">
    {{ errorMessage }}
  </ion-text>

  <!-- Leaderboard entries -->
  <ion-list *ngIf="!loading && !errorMessage">
    <ion-item *ngFor="let entry of entries">
      <ion-label>
        <h2>#{{ entry.rank }} {{ entry.displayName }}</h2>
        <p>
          Total: {{ entry.totalWorkScore }}
          &nbsp;·&nbsp;
          Cardio: {{ entry.cardioWorkScore }}
          &nbsp;·&nbsp;
          Strength: {{ entry.strengthWorkScore }}
        </p>
        <p *ngIf="entry.level !== undefined">Level: {{ entry.level }}</p>
        <ng-container *ngIf="entry.region as r">
          <p>{{ r.city }}, {{ r.state }}, {{ r.country }}</p>
        </ng-container>
      </ion-label>
    </ion-item>

    <ion-item *ngIf="entries.length === 0">
      <ion-label>No user stats found.</ion-label>
    </ion-item>
  </ion-list>
</ion-content>