<app-header [transparent]="true" [showBack]="true" backHref="/tabs/home"></app-header>

<ion-content [fullscreen]="true" class="profile-content">
  <div class="background-gradient"></div>
  <div class="profile-page">
    <div class="top-actions">
      <button
        type="button"
        class="settings-button"
        (click)="onSettingsClick()"
        aria-label="Open settings"
      >
        <ion-icon name="settings-outline"></ion-icon>
      </button>
    </div>

    <!-- Profile hero -->
    <div class="profile-hero">
      <button
        type="button"
        class="avatar-button"
        (click)="onProfileImageClick()"
        aria-label="Profile image actions"
      >
        <div class="avatar-wrap">
          <img
            class="avatar-img"
            [src]="profilepicUrl"
            alt="Profile"
          />
        </div>
      </button>

      <div class="identity">
        <div class="full-name">{{ displayName }}</div>
        <div class="username" *ngIf="displayUsername">@{{ displayUsername }}</div>
      </div>
    </div>

    <!-- Greek Statues Section (For both trainers and clients) -->
    <ion-card class="statues-card">
      <ion-list lines="full">
        <ion-item>
          <ion-icon slot="start" name="fitness" color="primary"></ion-icon>
          <ion-label>
            <h2>{{ currentUser?.accountType === 'trainer' ? 'Training Achievements' : 'Statues of Progress' }}</h2>
          </ion-label>
          <ion-button
            slot="end"
            fill="clear"
            (click)="openBadgeSelector()"
            size="small"
          >
            <ion-icon slot="icon-only" name="create-outline"></ion-icon>
          </ion-button>
        </ion-item>
      </ion-list>
      <ion-card-content>
        <div class="display-statues-carousel" *ngIf="displayStatues && displayStatues.length > 0; else noBadges">
          <swiper-container
            *ngIf="displayStatues.length > 0"
            [slidesPerView]="1"
            [centeredSlides]="true"
            [spaceBetween]="20"
            [pagination]="false"
            class="statue-swiper"
            (swiperslidechange)="onSlideChange($event)"
          >
            <swiper-slide *ngFor="let statue of displayStatues">
              <div class="podium-container">
                <div class="statue-showcase">
                  <app-greek-statue
                    [statue]="statue"
                    [showProgress]="true"
                    size="large"
                  ></app-greek-statue>
                </div>
                <div class="podium">
                  <div class="podium-top"></div>
                  <div class="podium-body">
                    <div class="podium-inscription">{{ statue.godName }}</div>
                  </div>
                </div>
              </div>
            </swiper-slide>
          </swiper-container>
          <div class="custom-pagination">
            <span
              class="pagination-dot"
              *ngFor="let statue of displayStatues; let i = index"
              [class.active]="i === currentSlideIndex"
            ></span>
          </div>
        </div>
        <ng-template #noBadges>
          <p class="no-badges-text" *ngIf="carvedStatuesCount === 0">
            Complete workouts to begin carving your statues!
            <br><small>Track your progress and showcase your divine masterpieces.</small>
          </p>
          <p class="no-badges-text" *ngIf="carvedStatuesCount > 0">
            No statues selected for display.
            <br><small>Click the button above to choose which statues to showcase.</small>
          </p>
        </ng-template>
      </ion-card-content>
    </ion-card>

    <!-- Trainer Stats Section (Only for trainers) -->
    <ion-card *ngIf="currentUser?.accountType === 'trainer'" class="trainer-stats-card">
      <ion-list lines="full">
        <ion-item>
          <ion-icon slot="start" name="stats-chart" color="primary"></ion-icon>
          <ion-label>
            <h2>Trainer Performance</h2>
          </ion-label>
        </ion-item>
      </ion-list>
      <ion-card-content>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value">{{ trainerStats.totalClients }}</div>
            <div class="stat-label">Active Clients</div>
          </div>
          
          <div class="stat-item">
            <div class="stat-value">{{ trainerStats.totalSessions }}</div>
            <div class="stat-label">Sessions Completed</div>
          </div>
          
          <div class="stat-item">
            <div class="stat-value">${{ trainerStats.totalRevenue.toFixed(0) }}</div>
            <div class="stat-label">Total Revenue</div>
          </div>
          
          <div class="stat-item highlight">
            <div class="stat-icon">
              <ion-icon name="trophy"></ion-icon>
            </div>
            <div class="stat-info">
              <div class="stat-value-small">{{ trainerStats.longestStandingClient.name }}</div>
              <div class="stat-label">Longest Client • {{ trainerStats.longestStandingClient.durationDays }} days</div>
            </div>
          </div>
          
          <div class="stat-item highlight">
            <div class="stat-icon">
              <ion-icon name="star"></ion-icon>
            </div>
            <div class="stat-info">
              <div class="stat-value-small">{{ trainerStats.topPerformingClient.name }}</div>
              <div class="stat-label">Top Client • {{ trainerStats.topPerformingClient.improvement }}</div>
            </div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Action stack (Hidden for trainers) -->
    <div *ngIf="currentUser?.accountType !== 'trainer'" class="action-stack">
      <button class="action-row" (click)="goToGroups()">
        <span>Groups</span>
        <ion-icon name="people-outline"></ion-icon>
      </button>

      <button class="action-row" (click)="goToLogWorkout()">
        <span>Log Workout</span>
        <ion-icon name="create-outline"></ion-icon>
      </button>

      <button class="action-row" (click)="goToFindPT()">
        <span>Find PT</span>
        <ion-icon name="search-outline"></ion-icon>
      </button>

      <button class="action-row" (click)="goToStatues()">
        <span>All Statues</span>
        <ion-icon name="trophy-outline"></ion-icon>
      </button>

      <button class="action-row" (click)="goToRegional()">
        <span>Regional</span>
        <ion-icon name="map-outline"></ion-icon>
      </button>

      <button class="action-row" (click)="goToAnalyzeWorkout()">
        <span>Analyze Workout</span>
        <ion-icon name="analytics-outline"></ion-icon>
      </button>
    </div>

  </div>
</ion-content>
